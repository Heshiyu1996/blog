<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Diff、React Diff、Vue Diff | Heshiyu&#39;s Blog</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/blog/favicon.png">
    <link rel="manifest" href="/blog/favicon.png">
    <link rel="apple-touch-icon" href="/blog/favicon.png">
    <link rel="mask-icon" href="/blog/favicon.png" color="#3eaf7c">
    <meta name="description" content=" ">
    <meta http-quiv="pragma" cotent="no-cache">
    <meta http-quiv="expires" cotent="0">
    <meta http-quiv="pragma" cotent="no-cache, must-revalidate">
    
    <link rel="preload" href="/blog/assets/css/0.styles.17457207.css" as="style"><link rel="preload" href="/blog/assets/js/app.d63006d9.js" as="script"><link rel="preload" href="/blog/assets/js/2.9a5e99eb.js" as="script"><link rel="preload" href="/blog/assets/js/3.fa7434c4.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.339f5947.js"><link rel="prefetch" href="/blog/assets/js/100.ab80963b.js"><link rel="prefetch" href="/blog/assets/js/101.2c14c6c4.js"><link rel="prefetch" href="/blog/assets/js/102.f83fbc46.js"><link rel="prefetch" href="/blog/assets/js/103.e27cb048.js"><link rel="prefetch" href="/blog/assets/js/104.2b8c5486.js"><link rel="prefetch" href="/blog/assets/js/105.c9fda933.js"><link rel="prefetch" href="/blog/assets/js/106.fb3cb2d4.js"><link rel="prefetch" href="/blog/assets/js/107.b17fd0ba.js"><link rel="prefetch" href="/blog/assets/js/108.8f53ca17.js"><link rel="prefetch" href="/blog/assets/js/109.275ba654.js"><link rel="prefetch" href="/blog/assets/js/11.274eb2f7.js"><link rel="prefetch" href="/blog/assets/js/110.ce307871.js"><link rel="prefetch" href="/blog/assets/js/111.7b8d0571.js"><link rel="prefetch" href="/blog/assets/js/112.b8b8c51c.js"><link rel="prefetch" href="/blog/assets/js/113.97db34eb.js"><link rel="prefetch" href="/blog/assets/js/114.fbe93be3.js"><link rel="prefetch" href="/blog/assets/js/115.6e5b55e7.js"><link rel="prefetch" href="/blog/assets/js/116.3d50d67b.js"><link rel="prefetch" href="/blog/assets/js/117.eee13489.js"><link rel="prefetch" href="/blog/assets/js/118.3cc8bf38.js"><link rel="prefetch" href="/blog/assets/js/119.05400da7.js"><link rel="prefetch" href="/blog/assets/js/12.bd658b98.js"><link rel="prefetch" href="/blog/assets/js/120.262ee91d.js"><link rel="prefetch" href="/blog/assets/js/121.44bbcc4f.js"><link rel="prefetch" href="/blog/assets/js/122.4d6fc54f.js"><link rel="prefetch" href="/blog/assets/js/123.d8589aa3.js"><link rel="prefetch" href="/blog/assets/js/124.e313b961.js"><link rel="prefetch" href="/blog/assets/js/125.ddfb97bd.js"><link rel="prefetch" href="/blog/assets/js/126.6fabe88b.js"><link rel="prefetch" href="/blog/assets/js/127.b28c5e68.js"><link rel="prefetch" href="/blog/assets/js/128.1febc323.js"><link rel="prefetch" href="/blog/assets/js/129.988e6ea3.js"><link rel="prefetch" href="/blog/assets/js/13.b8bffb2a.js"><link rel="prefetch" href="/blog/assets/js/130.88bd33fe.js"><link rel="prefetch" href="/blog/assets/js/131.989811e8.js"><link rel="prefetch" href="/blog/assets/js/132.5c5a4ddd.js"><link rel="prefetch" href="/blog/assets/js/133.1283a790.js"><link rel="prefetch" href="/blog/assets/js/134.abc803fe.js"><link rel="prefetch" href="/blog/assets/js/135.4f4c22ba.js"><link rel="prefetch" href="/blog/assets/js/136.1df96aea.js"><link rel="prefetch" href="/blog/assets/js/137.98c14067.js"><link rel="prefetch" href="/blog/assets/js/138.cf870798.js"><link rel="prefetch" href="/blog/assets/js/139.3d16446f.js"><link rel="prefetch" href="/blog/assets/js/14.ced142d6.js"><link rel="prefetch" href="/blog/assets/js/140.3ce24601.js"><link rel="prefetch" href="/blog/assets/js/141.b80df3e9.js"><link rel="prefetch" href="/blog/assets/js/142.4c600adb.js"><link rel="prefetch" href="/blog/assets/js/143.3dc4d279.js"><link rel="prefetch" href="/blog/assets/js/144.e6ed4908.js"><link rel="prefetch" href="/blog/assets/js/145.d7e1baa4.js"><link rel="prefetch" href="/blog/assets/js/146.61ca3273.js"><link rel="prefetch" href="/blog/assets/js/147.7c0f1ea7.js"><link rel="prefetch" href="/blog/assets/js/148.4e10d423.js"><link rel="prefetch" href="/blog/assets/js/149.f9ea9fd0.js"><link rel="prefetch" href="/blog/assets/js/15.5aaf76b4.js"><link rel="prefetch" href="/blog/assets/js/150.0718d308.js"><link rel="prefetch" href="/blog/assets/js/151.d6aac3d8.js"><link rel="prefetch" href="/blog/assets/js/152.b2a7f526.js"><link rel="prefetch" href="/blog/assets/js/153.ed46d47a.js"><link rel="prefetch" href="/blog/assets/js/154.439c7d27.js"><link rel="prefetch" href="/blog/assets/js/155.368c4984.js"><link rel="prefetch" href="/blog/assets/js/156.3468bfd0.js"><link rel="prefetch" href="/blog/assets/js/157.74b8dac4.js"><link rel="prefetch" href="/blog/assets/js/158.9d62397d.js"><link rel="prefetch" href="/blog/assets/js/159.c838c713.js"><link rel="prefetch" href="/blog/assets/js/16.d3ca195a.js"><link rel="prefetch" href="/blog/assets/js/160.b99aa9fc.js"><link rel="prefetch" href="/blog/assets/js/161.36d8a004.js"><link rel="prefetch" href="/blog/assets/js/162.76fa3ffe.js"><link rel="prefetch" href="/blog/assets/js/163.49c9b137.js"><link rel="prefetch" href="/blog/assets/js/164.fe7f7eb9.js"><link rel="prefetch" href="/blog/assets/js/165.205aebe8.js"><link rel="prefetch" href="/blog/assets/js/166.05eafb1d.js"><link rel="prefetch" href="/blog/assets/js/167.163de762.js"><link rel="prefetch" href="/blog/assets/js/168.2b89b0cf.js"><link rel="prefetch" href="/blog/assets/js/169.58907f68.js"><link rel="prefetch" href="/blog/assets/js/17.2b14844a.js"><link rel="prefetch" href="/blog/assets/js/170.5d3a3997.js"><link rel="prefetch" href="/blog/assets/js/171.0a6630d2.js"><link rel="prefetch" href="/blog/assets/js/172.0fe29856.js"><link rel="prefetch" href="/blog/assets/js/173.9a02fd8c.js"><link rel="prefetch" href="/blog/assets/js/174.234c39e2.js"><link rel="prefetch" href="/blog/assets/js/175.3dc6e7ca.js"><link rel="prefetch" href="/blog/assets/js/176.20248e35.js"><link rel="prefetch" href="/blog/assets/js/177.3a398008.js"><link rel="prefetch" href="/blog/assets/js/178.2accbd24.js"><link rel="prefetch" href="/blog/assets/js/179.1a725bdb.js"><link rel="prefetch" href="/blog/assets/js/18.c7cae76f.js"><link rel="prefetch" href="/blog/assets/js/180.d61d837e.js"><link rel="prefetch" href="/blog/assets/js/181.e980e97f.js"><link rel="prefetch" href="/blog/assets/js/182.aa2d5ae7.js"><link rel="prefetch" href="/blog/assets/js/183.bf6aaf89.js"><link rel="prefetch" href="/blog/assets/js/184.5044f410.js"><link rel="prefetch" href="/blog/assets/js/185.b0a35a79.js"><link rel="prefetch" href="/blog/assets/js/186.4ab4ed2c.js"><link rel="prefetch" href="/blog/assets/js/187.1d25f34a.js"><link rel="prefetch" href="/blog/assets/js/188.318f213a.js"><link rel="prefetch" href="/blog/assets/js/189.5d98dbdc.js"><link rel="prefetch" href="/blog/assets/js/19.22354c72.js"><link rel="prefetch" href="/blog/assets/js/190.6df9ffe9.js"><link rel="prefetch" href="/blog/assets/js/191.ff626e97.js"><link rel="prefetch" href="/blog/assets/js/192.4d0be1bf.js"><link rel="prefetch" href="/blog/assets/js/193.64349f63.js"><link rel="prefetch" href="/blog/assets/js/194.e0616164.js"><link rel="prefetch" href="/blog/assets/js/20.338232eb.js"><link rel="prefetch" href="/blog/assets/js/21.ccb15356.js"><link rel="prefetch" href="/blog/assets/js/22.743e2c34.js"><link rel="prefetch" href="/blog/assets/js/23.cdd9345b.js"><link rel="prefetch" href="/blog/assets/js/24.45ba1767.js"><link rel="prefetch" href="/blog/assets/js/25.7efb1c0e.js"><link rel="prefetch" href="/blog/assets/js/26.ab221922.js"><link rel="prefetch" href="/blog/assets/js/27.f3eb7ffb.js"><link rel="prefetch" href="/blog/assets/js/28.3bb28a32.js"><link rel="prefetch" href="/blog/assets/js/29.2d3a6b69.js"><link rel="prefetch" href="/blog/assets/js/30.d178241d.js"><link rel="prefetch" href="/blog/assets/js/31.17ad23f1.js"><link rel="prefetch" href="/blog/assets/js/32.a97da663.js"><link rel="prefetch" href="/blog/assets/js/33.f3c98b68.js"><link rel="prefetch" href="/blog/assets/js/34.8c60c5ee.js"><link rel="prefetch" href="/blog/assets/js/35.d03aff4a.js"><link rel="prefetch" href="/blog/assets/js/36.bfb69e94.js"><link rel="prefetch" href="/blog/assets/js/37.177e001a.js"><link rel="prefetch" href="/blog/assets/js/38.53e01a4c.js"><link rel="prefetch" href="/blog/assets/js/39.141b89ce.js"><link rel="prefetch" href="/blog/assets/js/4.edf6b75e.js"><link rel="prefetch" href="/blog/assets/js/40.15b63871.js"><link rel="prefetch" href="/blog/assets/js/41.873ab8f2.js"><link rel="prefetch" href="/blog/assets/js/42.b523cb93.js"><link rel="prefetch" href="/blog/assets/js/43.0236b284.js"><link rel="prefetch" href="/blog/assets/js/44.11183afb.js"><link rel="prefetch" href="/blog/assets/js/45.92361b8b.js"><link rel="prefetch" href="/blog/assets/js/46.41d6cb4e.js"><link rel="prefetch" href="/blog/assets/js/47.5f87d0f5.js"><link rel="prefetch" href="/blog/assets/js/48.63e5abcb.js"><link rel="prefetch" href="/blog/assets/js/49.6d1d0e00.js"><link rel="prefetch" href="/blog/assets/js/5.7a340c95.js"><link rel="prefetch" href="/blog/assets/js/50.52f819f6.js"><link rel="prefetch" href="/blog/assets/js/51.51420c48.js"><link rel="prefetch" href="/blog/assets/js/52.aac4d19a.js"><link rel="prefetch" href="/blog/assets/js/53.f6d41362.js"><link rel="prefetch" href="/blog/assets/js/54.ff44409b.js"><link rel="prefetch" href="/blog/assets/js/55.7c5371f0.js"><link rel="prefetch" href="/blog/assets/js/56.0ad04af7.js"><link rel="prefetch" href="/blog/assets/js/57.3d0624c3.js"><link rel="prefetch" href="/blog/assets/js/58.6a92cd25.js"><link rel="prefetch" href="/blog/assets/js/59.74acf14e.js"><link rel="prefetch" href="/blog/assets/js/6.29edfd14.js"><link rel="prefetch" href="/blog/assets/js/60.be638a04.js"><link rel="prefetch" href="/blog/assets/js/61.6b37fbf5.js"><link rel="prefetch" href="/blog/assets/js/62.c04c0d0e.js"><link rel="prefetch" href="/blog/assets/js/63.070a6709.js"><link rel="prefetch" href="/blog/assets/js/64.bd1af6d0.js"><link rel="prefetch" href="/blog/assets/js/65.f0165026.js"><link rel="prefetch" href="/blog/assets/js/66.ab6ae7a1.js"><link rel="prefetch" href="/blog/assets/js/67.6e76ed69.js"><link rel="prefetch" href="/blog/assets/js/68.2fa544fe.js"><link rel="prefetch" href="/blog/assets/js/69.36b1de75.js"><link rel="prefetch" href="/blog/assets/js/7.8119d2aa.js"><link rel="prefetch" href="/blog/assets/js/70.1cce33e7.js"><link rel="prefetch" href="/blog/assets/js/71.820308b8.js"><link rel="prefetch" href="/blog/assets/js/72.d3ef2f97.js"><link rel="prefetch" href="/blog/assets/js/73.c81396ed.js"><link rel="prefetch" href="/blog/assets/js/74.e22dcbcb.js"><link rel="prefetch" href="/blog/assets/js/75.3898d7da.js"><link rel="prefetch" href="/blog/assets/js/76.be3d80a8.js"><link rel="prefetch" href="/blog/assets/js/77.098a974d.js"><link rel="prefetch" href="/blog/assets/js/78.2abe05e1.js"><link rel="prefetch" href="/blog/assets/js/79.bdcd471c.js"><link rel="prefetch" href="/blog/assets/js/8.297ec135.js"><link rel="prefetch" href="/blog/assets/js/80.5d37d2a0.js"><link rel="prefetch" href="/blog/assets/js/81.c4ecb646.js"><link rel="prefetch" href="/blog/assets/js/82.19540c6e.js"><link rel="prefetch" href="/blog/assets/js/83.f478a428.js"><link rel="prefetch" href="/blog/assets/js/84.0a5f4434.js"><link rel="prefetch" href="/blog/assets/js/85.4bfcbc62.js"><link rel="prefetch" href="/blog/assets/js/86.2090dc6f.js"><link rel="prefetch" href="/blog/assets/js/87.36fdfd7e.js"><link rel="prefetch" href="/blog/assets/js/88.e62aaf12.js"><link rel="prefetch" href="/blog/assets/js/89.d89f4a5b.js"><link rel="prefetch" href="/blog/assets/js/9.0def6cd3.js"><link rel="prefetch" href="/blog/assets/js/90.1b11884e.js"><link rel="prefetch" href="/blog/assets/js/91.8829546d.js"><link rel="prefetch" href="/blog/assets/js/92.b43a0157.js"><link rel="prefetch" href="/blog/assets/js/93.02c47c55.js"><link rel="prefetch" href="/blog/assets/js/94.0984de88.js"><link rel="prefetch" href="/blog/assets/js/95.283525db.js"><link rel="prefetch" href="/blog/assets/js/96.f2666003.js"><link rel="prefetch" href="/blog/assets/js/97.13608523.js"><link rel="prefetch" href="/blog/assets/js/98.5f2fbf82.js"><link rel="prefetch" href="/blog/assets/js/99.caef36ff.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.17457207.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">Heshiyu's Blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/overview/" class="nav-link">
  总览
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="基础" class="dropdown-title"><span class="title">基础</span> <span class="arrow down"></span></button> <button type="button" aria-label="基础" class="mobile-dropdown-title"><span class="title">基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          基础
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/blog/skill/html/" class="nav-link">
  HTML
</a></li><li class="dropdown-subitem"><a href="/blog/skill/css/" class="nav-link">
  CSS
</a></li><li class="dropdown-subitem"><a href="/blog/skill/js/" class="nav-link">
  JS
</a></li><li class="dropdown-subitem"><a href="/blog/skill/web/" class="nav-link router-link-active">
  Web
</a></li></ul></li><li class="dropdown-item"><h4>
          框架
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/blog/skill/react/" class="nav-link">
  React
</a></li><li class="dropdown-subitem"><a href="/blog/skill/vue/" class="nav-link">
  Vue
</a></li><li class="dropdown-subitem"><a href="/blog/skill/nodejs/" class="nav-link">
  NodeJS
</a></li></ul></li><li class="dropdown-item"><h4>
          其它
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/blog/skill/computeracy/" class="nav-link">
  计算机
</a></li><li class="dropdown-subitem"><a href="/blog/skill/algorithm/" class="nav-link">
  算法
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="实践" class="dropdown-title"><span class="title">实践</span> <span class="arrow down"></span></button> <button type="button" aria-label="实践" class="mobile-dropdown-title"><span class="title">实践</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          平台
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/blog/business/practice/h5/" class="nav-link">
  H5
</a></li><li class="dropdown-subitem"><a href="/blog/business/practice/pc/" class="nav-link">
  PC
</a></li><li class="dropdown-subitem"><a href="/blog/business/practice/rn/" class="nav-link">
  RN
</a></li><li class="dropdown-subitem"><a href="/blog/business/practice/other/" class="nav-link">
  其它
</a></li></ul></li><li class="dropdown-item"><h4>
          工具
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/blog/business/tool/" class="nav-link">
  工程工具
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="周边" class="dropdown-title"><span class="title">周边</span> <span class="arrow down"></span></button> <button type="button" aria-label="周边" class="mobile-dropdown-title"><span class="title">周边</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          产出
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/blog/other/output/standard/js/" class="nav-link">
  前端规范
</a></li><li class="dropdown-subitem"><a href="/blog/other/output/fruit/template/" class="nav-link">
  前端工程模板（React）
</a></li></ul></li><li class="dropdown-item"><h4>
          心得
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/blog/other/feeling/" class="nav-link">
  读书/参会心得
</a></li><li class="dropdown-subitem"><a href="/blog/other/review/" class="nav-link">
  梳理
</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/blog/tool/" class="nav-link">
  工具
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/overview/" class="nav-link">
  总览
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="基础" class="dropdown-title"><span class="title">基础</span> <span class="arrow down"></span></button> <button type="button" aria-label="基础" class="mobile-dropdown-title"><span class="title">基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          基础
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/blog/skill/html/" class="nav-link">
  HTML
</a></li><li class="dropdown-subitem"><a href="/blog/skill/css/" class="nav-link">
  CSS
</a></li><li class="dropdown-subitem"><a href="/blog/skill/js/" class="nav-link">
  JS
</a></li><li class="dropdown-subitem"><a href="/blog/skill/web/" class="nav-link router-link-active">
  Web
</a></li></ul></li><li class="dropdown-item"><h4>
          框架
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/blog/skill/react/" class="nav-link">
  React
</a></li><li class="dropdown-subitem"><a href="/blog/skill/vue/" class="nav-link">
  Vue
</a></li><li class="dropdown-subitem"><a href="/blog/skill/nodejs/" class="nav-link">
  NodeJS
</a></li></ul></li><li class="dropdown-item"><h4>
          其它
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/blog/skill/computeracy/" class="nav-link">
  计算机
</a></li><li class="dropdown-subitem"><a href="/blog/skill/algorithm/" class="nav-link">
  算法
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="实践" class="dropdown-title"><span class="title">实践</span> <span class="arrow down"></span></button> <button type="button" aria-label="实践" class="mobile-dropdown-title"><span class="title">实践</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          平台
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/blog/business/practice/h5/" class="nav-link">
  H5
</a></li><li class="dropdown-subitem"><a href="/blog/business/practice/pc/" class="nav-link">
  PC
</a></li><li class="dropdown-subitem"><a href="/blog/business/practice/rn/" class="nav-link">
  RN
</a></li><li class="dropdown-subitem"><a href="/blog/business/practice/other/" class="nav-link">
  其它
</a></li></ul></li><li class="dropdown-item"><h4>
          工具
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/blog/business/tool/" class="nav-link">
  工程工具
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="周边" class="dropdown-title"><span class="title">周边</span> <span class="arrow down"></span></button> <button type="button" aria-label="周边" class="mobile-dropdown-title"><span class="title">周边</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          产出
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/blog/other/output/standard/js/" class="nav-link">
  前端规范
</a></li><li class="dropdown-subitem"><a href="/blog/other/output/fruit/template/" class="nav-link">
  前端工程模板（React）
</a></li></ul></li><li class="dropdown-item"><h4>
          心得
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/blog/other/feeling/" class="nav-link">
  读书/参会心得
</a></li><li class="dropdown-subitem"><a href="/blog/other/review/" class="nav-link">
  梳理
</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/blog/tool/" class="nav-link">
  工具
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>《Web》</span> <!----></p> <!----></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Web</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/skill/web/http-cache/" class="sidebar-link">HTTP缓存机制</a></li><li><a href="/blog/skill/web/cdn/" class="sidebar-link">CDN</a></li><li><a href="/blog/skill/web/cors/" class="sidebar-link">跨域资源共享（CORS）</a></li><li><a href="/blog/skill/web/http/" class="sidebar-link">HTTP</a></li><li><a href="/blog/skill/web/optimize/" class="sidebar-link">Web性能优化</a></li><li><a href="/blog/skill/web/ssr/" class="sidebar-link">浏览器/服务端渲染</a></li><li><a href="/blog/skill/web/diff/" aria-current="page" class="active sidebar-link">Diff、React Diff、Vue Diff</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/skill/web/diff/#传统diff算法" class="sidebar-link">传统diff算法</a></li><li class="sidebar-sub-header"><a href="/blog/skill/web/diff/#什么是virtual-dom" class="sidebar-link">什么是Virtual DOM</a></li><li class="sidebar-sub-header"><a href="/blog/skill/web/diff/#react-virtual-dom-diff" class="sidebar-link">[React] Virtual DOM Diff</a></li><li class="sidebar-sub-header"><a href="/blog/skill/web/diff/#react-fiber-diff" class="sidebar-link">[React] Fiber Diff</a></li><li class="sidebar-sub-header"><a href="/blog/skill/web/diff/#vue-virtual-dom-diff" class="sidebar-link">[Vue] Virtual DOM Diff</a></li><li class="sidebar-sub-header"><a href="/blog/skill/web/diff/#四种diff算法总结" class="sidebar-link">四种Diff算法总结</a></li><li class="sidebar-sub-header"><a href="/blog/skill/web/diff/#参考链接" class="sidebar-link">参考链接</a></li></ul></li><li><a href="/blog/skill/web/web-attack/" class="sidebar-link">XSS、CSRF、SQL注入</a></li><li><a href="/blog/skill/web/web-storage/" class="sidebar-link">WebStorage</a></li><li><a href="/blog/skill/web/websocket/" class="sidebar-link">WebSocket</a></li><li><a href="/blog/skill/web/nginx/" class="sidebar-link">Nginx</a></li><li><a href="/blog/skill/web/pwa/" class="sidebar-link">PWA</a></li><li><a href="/blog/skill/web/browser/" class="sidebar-link">浏览器基础</a></li><li><a href="/blog/skill/web/history/" class="sidebar-link">前端路由</a></li><li><a href="/blog/skill/web/audio-context/" class="sidebar-link">AudioContext</a></li><li><a href="/blog/skill/web/other/" class="sidebar-link">其他</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Hybrid</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/skill/web/jsbridge/" class="sidebar-link">JSBridge通信</a></li><li><a href="/blog/skill/web/h5-webcache/" class="sidebar-link">H5离线包</a></li><li><a href="/blog/skill/web/mini-program/" class="sidebar-link">小程序和H5的区别</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="diff、react-diff、vue-diff"><a href="#diff、react-diff、vue-diff" class="header-anchor">#</a> Diff、React Diff、Vue Diff</h1> <p></p><div class="table-of-contents"><ul><li><a href="#diff、react-diff、vue-diff">Diff、React Diff、Vue Diff</a><ul><li><a href="#传统diff算法">传统diff算法</a></li><li><a href="#什么是virtual-dom">什么是Virtual DOM</a></li><li><a href="#react-virtual-dom-diff">[React] Virtual DOM Diff</a></li><li><a href="#react-fiber-diff">[React] Fiber Diff</a></li><li><a href="#vue-virtual-dom-diff">[Vue] Virtual DOM Diff</a></li><li><a href="#四种diff算法总结">四种Diff算法总结</a></li><li><a href="#参考链接">参考链接</a></li></ul></li></ul></div><p></p> <h2 id="传统diff算法"><a href="#传统diff算法" class="header-anchor">#</a> 传统diff算法</h2> <blockquote><p>算法复杂度O(n3)</p></blockquote> <p>通过<strong>递归</strong>，对 HTML DOM树里的节点 进行依次对比。</p> <h2 id="什么是virtual-dom"><a href="#什么是virtual-dom" class="header-anchor">#</a> 什么是Virtual DOM</h2> <p>渲染真实DOM的开销很大，直接渲染到真实DOM会引起整个DOM树的<strong>重排</strong>和<strong>重绘</strong>。</p> <p>React、Vue都<strong>采用Virtual DOM来实现对真实DOM的映射</strong>，所以React Diff、Vue Diff算法的实质是 <strong>对两个JavaScript对象的差异查找</strong>。</p> <p>真实DOM：</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>reactID<span class="token punctuation">&quot;</span></span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>myDiv<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li>React Virtual DOM</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token punctuation">{</span>
  type<span class="token operator">:</span> <span class="token string">'div'</span><span class="token punctuation">,</span>
  props<span class="token operator">:</span> <span class="token punctuation">{</span>
      id<span class="token operator">:</span> <span class="token string">'reactID'</span><span class="token punctuation">,</span>
      className<span class="token operator">:</span> <span class="token string">'myDiv'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  chidren<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>type<span class="token operator">:</span> <span class="token string">'p'</span><span class="token punctuation">,</span>props<span class="token operator">:</span><span class="token punctuation">{</span>value<span class="token operator">:</span><span class="token string">'1'</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><ul><li>Vue Virtual DOM</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// body下的 &lt;div id=&quot;vueId&quot; class=&quot;classA&quot;&gt;&lt;div&gt; 对应的 oldVnode 就是</span>
<span class="token punctuation">{</span>
  el<span class="token operator">:</span>  div  <span class="token comment">//对真实的节点的引用，本例中就是document.querySelector('#vueId.classA')</span>
  tagName<span class="token operator">:</span> <span class="token string">'DIV'</span><span class="token punctuation">,</span>   <span class="token comment">//节点的标签</span>
  sel<span class="token operator">:</span> <span class="token string">'div#vueId.classA'</span>  <span class="token comment">//节点的选择器</span>
  data<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>       <span class="token comment">// 一个存储节点属性的对象，对应节点的el[prop]属性，例如onclick , style</span>
  children<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">//存储子节点的数组，每个子节点也是vnode结构</span>
  text<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>    <span class="token comment">//如果是文本节点，对应文本节点的textContent，否则为null</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h2 id="react-virtual-dom-diff"><a href="#react-virtual-dom-diff" class="header-anchor">#</a> [React] Virtual DOM Diff</h2> <blockquote><p>算法复杂度为O(n)</p></blockquote> <p>React diff（v16前）基于三个策略：</p> <ul><li>忽略DOM节点的跨层级移动</li> <li>拥有相同类的两个组件将会生成相似的树形结构，拥有不同类的两个组件将会生成不同的树形结构</li> <li>同一层级的一组子节点，通过<code>key</code>值进行区分</li></ul> <p>基于以上三个策略，React分别对<code>tree diff</code>、<code>component diff</code>、<code>element diff</code>进行了算法优化。</p> <blockquote><p>即：不同层级不比、不同组件类型不比、不同key值不比</p></blockquote> <h3 id="tree-diff"><a href="#tree-diff" class="header-anchor">#</a> tree diff</h3> <p><strong>比较范围：</strong> 树之间。</p> <p><strong>步骤：</strong> 对树进行分层比较，两棵树只会对同一层次的节点进行比较。如果节点不存在了则会直接销毁。不会进一步比较。</p> <blockquote><p>所以只需对树进行一次遍历，便能完成整个DOM树的比较。</p></blockquote> <p><img src="/blog/assets/img/img-1.500eeda9.png" alt="alt"></p> <blockquote><p>React只会对相同颜色方框内的DOM节点进行比较（即同一个父节点下的所有子节点）。</p></blockquote> <p><strong>建议：</strong>
尽量保持 DOM结构 的稳定，避免 移除/添加DOM节点 （可用 CSS 代替）</p> <h4 id="对于跨层级的节点-只有-创建-和-删除-操作"><a href="#对于跨层级的节点-只有-创建-和-删除-操作" class="header-anchor">#</a> 对于跨层级的节点，只有 创建 和 删除 操作</h4> <p><img src="/blog/assets/img/img-2.ee0d472c.png" alt="alt"></p> <blockquote><p>React diff 的执行情况： delete A -&gt; create A -&gt; create B -&gt; create C。</p></blockquote> <h3 id="component-diff"><a href="#component-diff" class="header-anchor">#</a> component diff</h3> <p><strong>比较范围：</strong> 组件之间。</p> <p><strong>步骤：</strong></p> <ul><li>同一类型的组件（即：两节点是同一个组件类的两个不同实例），按照 <code>同层比较策略</code> 继续比较Virtual DOM tree（也可以指定<code>shouldComponentUpdate</code>无需比较）</li> <li>如果不是，则将该组件判断为<code>dirty component</code>，从而替换整个组件（因为React认为：不同类型的组件，DOM树相同的情况非常少）</li></ul> <p><img src="/blog/assets/img/img-3.653037c4.png" alt="alt"></p> <blockquote><p>当component D改变为component G时，React会认为 <strong>D和G是不同类型的组件</strong> ，就不会比较二者的结构。从而直接 “删除component D”，“重新创建component G以及其子节点”。</p></blockquote> <p><strong>建议：</strong></p> <ul><li>当明确知道是 “同一类型的组件” 时，可以通过 <code>shouldComponentUpdate()</code> 来指定该组件是否需要diff</li> <li>对于类似的结构应尽量封装成组件，既减少代码量，又能减少 component diff 带来的性能损耗。</li></ul> <h3 id="element-diff"><a href="#element-diff" class="header-anchor">#</a> element diff</h3> <p><strong>比较范围：</strong> 同一层级下的节点之间。</p> <p>React Element Diff 会进行 3 类操作：<strong>插入、删除、移动</strong>。</p> <p><strong>步骤：</strong></p> <ul><li>循环遍历 新集合的节点</li> <li>判断 <strong>新旧集合是否存在相同的节点</strong>（通过唯一的<code>key</code>值）；如果不存在，则直接 <strong>插入</strong>；</li> <li>否则，会比较 <code>该节点在 旧集合中的位置（child._mountIndex）</code> 与 <code>遍历已访问过的节点，在旧集合中最右的位置（lastIndex）</code></li> <li><code>if (child._mountIndex &gt;s lastIndex)</code>，说明 该节点在 旧集合中的位置 就比 上一个节点位置 的后面，并且该节点不会影响其他节点的位置，<strong>不需要移动</strong>；</li> <li>否则，进行<strong>移动</strong></li></ul> <p><img src="/blog/assets/img/img-4.2a5ca4ea.png" alt="alt"></p> <blockquote><p>React diff 的执行情况：B、D不作任何操作，A、C进行移动即可。</p></blockquote> <p><strong>建议：</strong></p> <ul><li>同一层级下的子节点 需要设置 <code>key</code> 值</li> <li>尽量减少类似 “将最后一个节点 移动到 列表首部” 这样的操作</li></ul> <blockquote><p>React Element Diff 和 Vue 不太一样。Vue采用的是：由<strong>两端至中间</strong>，先是4种比较方式，都匹配不上，就是key比较。</p></blockquote> <h3 id="react更新阶段"><a href="#react更新阶段" class="header-anchor">#</a> React更新阶段</h3> <p>实际上，只有在 <strong>React更新阶段的DOM元素更新过程</strong> 才会执行Diff算法。</p> <p>React更新阶段会对ReactElement类型（Text节点、组件、DOM）判断，从而进行不同的操作。</p> <ul><li>Text节点：直接更新文案</li> <li>组件：结合策略二</li> <li>DOM：<strong>调用diff算法</strong>（<code>this._updateDOMChildren</code>）</li></ul> <p><img src="/blog/assets/img/img-5.b53b39e8.png" alt="alt"></p> <h3 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h3> <p><img src="/blog/assets/img/img-6.e7a97a31.png" alt="alt">)</p> <h2 id="react-fiber-diff"><a href="#react-fiber-diff" class="header-anchor">#</a> [React] Fiber Diff</h2> <p>React16改造了Virtal DOM的结构，引入了<code>Fiber</code>的链表结构。</p> <blockquote><p>因为以前的Virtual DOM Diff可能比较耗时，导致浏览器FPS降低。</p></blockquote> <h3 id="react-fiber"><a href="#react-fiber" class="header-anchor">#</a> React Fiber</h3> <p><code>Fiber节点</code>就相当于以前的 Virtual DOM节点 ，结构如下：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> Fiber <span class="token operator">=</span> <span class="token punctuation">{</span>
  tag<span class="token operator">:</span> <span class="token constant">HOST_COMPONENT</span><span class="token punctuation">,</span>
  type<span class="token operator">:</span> <span class="token string">&quot;div&quot;</span><span class="token punctuation">,</span>
  <span class="token keyword">return</span><span class="token operator">:</span> parentFiber<span class="token punctuation">,</span> <span class="token comment">// 当前节点的父节点</span>
  child<span class="token operator">:</span> childFiber<span class="token punctuation">,</span> <span class="token comment">// 第一个子节点</span>
  sibling<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token comment">// 右边的第一个兄弟节点</span>
  alternate<span class="token operator">:</span> currentFiber<span class="token punctuation">,</span> <span class="token comment">// 当前节点对应的新Fiber节点（带有新的props和state）</span>
  stateNode<span class="token operator">:</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;div&quot;</span><span class="token punctuation">)</span><span class="token operator">|</span> instance<span class="token punctuation">,</span>
  props<span class="token operator">:</span> <span class="token punctuation">{</span> children<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> className<span class="token operator">:</span> <span class="token string">&quot;foo&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  partialState<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
  effectTag<span class="token operator">:</span> <span class="token constant">PLACEMENT</span><span class="token punctuation">,</span>
  effects<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>假设有这么一个DOM结构：</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>通过 <strong>链表的形式</strong> 去描述整棵树：</p> <p><img src="/blog/assets/img/img-10.a5b62bc7.png" alt="alt"></p> <p><strong>Fiber数据结构选用链表</strong>的好处：在遍历Diff时，即使中断了，但只需记住中断时的那个节点，就可在下一个时间片空闲时，继续Diff。</p> <h3 id="fiber-diff的大致过程"><a href="#fiber-diff的大致过程" class="header-anchor">#</a> Fiber Diff的大致过程</h3> <p><strong>从链表头开始遍历，碰到一个节点就和它自己的 <code>alternate</code> 比较，并记录下需要更新的东西（作为<code>commit</code>），并把这些更新通过 <code>return</code> 提交到当前节点的父节点。当遍历完整个链表时，再通过 <code>return</code> 回溯到根节点。这样就能把所有的更新全部带到根节点，最后更新到真实的DOM中。</strong></p> <blockquote><p>Fiber Diff算法是基于 <strong>节点的“插入、删除、移动”等操作都是在同一层级中进行</strong> 这个前提的。</p></blockquote> <p><img src="/blog/assets/img/img-12.87ce9ca7.png" alt="alt"></p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>从根节点开始：</p> <ul><li>div1通过 child 到div2</li> <li>div2 和自己的 alternate 比较完，把更新 commit1 通过return 提交到 div1</li> <li>div2 通过 sibling 到ul 1</li> <li>ul1 和自己的 alternate 比较完，把更新 commit2 通过return 提交到 div1</li> <li>ul1 通过 child 到 li1</li> <li>li1 和自己的 alternate 比较完，把更新 commit3 通过return 提交到 ul1</li> <li>li1 通过 sibling 到 li2</li> <li>li2 和自己的 alternate 比较完，把更新 commit4 通过return 提交到 ul1</li> <li><strong>遍历完成，开始回溯。li2 通过 return 回到 ul1</strong>（注意是到 li2 才 return）</li> <li>ul1 把 commit3 和 commit4 通过 return 提交到 div</li> <li>ul1 通过 return 到 div1</li> <li>div1 获取到所有更新 commit1、commit2、commit3、commit4，一次性更新到真实的DOM中</li></ul></div> <h3 id="fiber-diff的入口函数"><a href="#fiber-diff的入口函数" class="header-anchor">#</a> Fiber Diff的入口函数</h3> <p>Fiber Diff是从 <code>reconcileChildren</code> 开始的 <em>（非首次渲染时）</em></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">reconcileChildren</span><span class="token punctuation">(</span>
  <span class="token parameter">current<span class="token operator">:</span> Fiber <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
  workInProgress<span class="token operator">:</span> Fiber<span class="token punctuation">,</span>
  nextChildren<span class="token operator">:</span> any<span class="token punctuation">,</span>
  renderExpirationTime<span class="token operator">:</span> ExpirationTime<span class="token punctuation">,</span></span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 如果首次渲染，通过mountChildFibers创建子节点的Fiber实例</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>current <span class="token operator">===</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    workInProgress<span class="token punctuation">.</span>child <span class="token operator">=</span> <span class="token function">mountChildFibers</span><span class="token punctuation">(</span>
      workInProgress<span class="token punctuation">,</span>
      <span class="token keyword">null</span><span class="token punctuation">,</span>
      nextChildren<span class="token punctuation">,</span>
      renderExpirationTime<span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  <span class="token comment">// 否则，通过reconcileChildFibers进行Diff</span>
    workInProgress<span class="token punctuation">.</span>child <span class="token operator">=</span> <span class="token function">reconcileChildFibers</span><span class="token punctuation">(</span>
      workInProgress<span class="token punctuation">,</span>
      current<span class="token punctuation">.</span>child<span class="token punctuation">,</span>
      nextChildren<span class="token punctuation">,</span>
      renderExpirationTime<span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p><code>reconcileChildFibers</code>函数的作用：<strong>构建<code>currentInWorkProgress</code>，然后得出<code>effect list</code>，为下一个阶段（commit）做准备</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">reconcileChildFibers</span><span class="token punctuation">(</span>
  returnFiber<span class="token operator">:</span> Fiber<span class="token punctuation">,</span> <span class="token comment">// 即将Diff的这层的父节点</span>
  currentFirstChild<span class="token operator">:</span> Fiber <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token comment">// 当前层的第一个Fiber节点</span>
  newChild<span class="token operator">:</span> any<span class="token punctuation">,</span> <span class="token comment">// 即将更新的vdom节点（可能是个TextNode、可能是ReactElement、可能是数组），不是Fiber节点</span>
  expirationTime<span class="token operator">:</span> ExpirationTime<span class="token punctuation">,</span> <span class="token comment">// 过期时间（与diff无关）</span>
<span class="token punctuation">)</span><span class="token operator">:</span> Fiber <span class="token operator">|</span> <span class="token keyword">null</span> <span class="token punctuation">{</span>
  <span class="token comment">// 主要的 Diff 逻辑</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>对于 <code>currentFirstChild</code> 会有 <strong>4 种情况</strong>：</p> <ul><li>TextNode</li> <li>React Element（通过该节点是否有 <code>$$typeof</code> 区分）</li> <li>数组</li> <li>可迭代的children（跟数组的处理方式差不多）</li></ul> <blockquote><p>注意：currentFirstNode是当前层的第一个Fiber节点。</p></blockquote> <h3 id="textnode【待更新】"><a href="#textnode【待更新】" class="header-anchor">#</a> TextNode【待更新】</h3> <p>如果<code>currentFirstChild</code> 是 <code>TextNode</code></p> <ul><li><code>xxx</code> 也是 <code>TextNode</code>，那就代表这个节点可以复用</li> <li><code>xxx</code> 不是 <code>TextNode</code></li></ul> <p>Demo：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// before：当前 UI 对应的节点的 jsx</span>
<span class="token keyword">return</span> <span class="token punctuation">(</span>
  <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
  <span class="token comment">// ...</span>
      <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span>xxx<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>xxx<span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span>xxx<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>xxx<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token comment">//...</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token punctuation">)</span>

<span class="token comment">// after：更新成功后的节点对应的 jsx</span>
<span class="token keyword">return</span> <span class="token punctuation">(</span>
  <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
  <span class="token comment">// ...</span>
      <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
          前端桃园
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token comment">//...</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p><img src="/blog/assets/img/img-10.a5b62bc7.png" alt="alt"></p> <p>若<code>currentFirstNode</code>不是TextNode，就代表这个节点不能复用。会从<code>currentFirstNode</code>开始，<strong>删除剩余的节点</strong>。</p> <h3 id="react-element【待更新】"><a href="#react-element【待更新】" class="header-anchor">#</a> React Element【待更新】</h3> <p>对于<code>React Element</code>判断这个节点是否可以复用：</p> <ul><li>key相同</li> <li>节点的类型相同</li></ul> <p>同时满足以上两点，代表这个节点只是内容变化，不需要创建新的节点，是可以复用的。</p> <p>如果节点类型不相同，就将节点从当前节点开始，把剩余的都删除。</p> <h3 id="array【待更新】"><a href="#array【待更新】" class="header-anchor">#</a> Array【待更新】</h3> <p>建议：在开发组件时，保持稳定的DOM结构有助于性能提升。</p> <h2 id="vue-virtual-dom-diff"><a href="#vue-virtual-dom-diff" class="header-anchor">#</a> [Vue] Virtual DOM Diff</h2> <p>Vue 和 React一样，只进行 <strong>同层比较，忽略跨级操作</strong> 。</p> <blockquote><p>不同层级不比，不同类型不比</p></blockquote> <p>当响应式属性 <code>setter</code> 执行 <code>Dep.notify()</code> 时，就会开始执行 <code>patch</code> 。</p> <blockquote><p>一边比较新、旧节点，一边给 <code>真实DOM</code> 打补丁。</p></blockquote> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">patch</span> <span class="token punctuation">(</span><span class="token parameter">oldVnode<span class="token punctuation">,</span> vnode</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// sameVnode 会当两节点的 key &amp;&amp; sel（即元素的css选择器） 相同时，认为是同一类型节点。</span>
    <span class="token comment">// 此时才需要 “深入比较”</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">sameVnode</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">patchVnode</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// 不同类型节点，直接用新节点替换整个老节点</span>
        <span class="token keyword">const</span> oEl <span class="token operator">=</span> oldVnode<span class="token punctuation">.</span>el
        <span class="token keyword">let</span> parentEle <span class="token operator">=</span> api<span class="token punctuation">.</span><span class="token function">parentNode</span><span class="token punctuation">(</span>oEl<span class="token punctuation">)</span>
        <span class="token function">createEle</span><span class="token punctuation">(</span>vnode<span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>parentEle <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            api<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span>parentEle<span class="token punctuation">,</span> vnode<span class="token punctuation">.</span>el<span class="token punctuation">,</span> api<span class="token punctuation">.</span><span class="token function">nextSibling</span><span class="token punctuation">(</span>oEl<span class="token punctuation">)</span><span class="token punctuation">)</span>
            api<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>parentEle<span class="token punctuation">,</span> oldVnode<span class="token punctuation">.</span>el<span class="token punctuation">)</span>
            oldVnode <span class="token operator">=</span> <span class="token keyword">null</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> vnode
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>这和 React Diff 实现不同，react 对于 “同一类型节点” 的认定标准 是 “同一个Class实例化出来的节点元素”。</p> <h3 id="patchvnode"><a href="#patchvnode" class="header-anchor">#</a> patchVnode</h3> <p>两个节点值得比较时，会调用<code>patchVnode</code></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">patchVnode</span> <span class="token punctuation">(</span><span class="token parameter">oldVnode<span class="token punctuation">,</span> vnode</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 作用：让vnode.el引用到现在真实dom（即oldVnode.el）；同时当el发生变化时，vnode.el会同时变化</span>
    <span class="token keyword">const</span> el <span class="token operator">=</span> vnode<span class="token punctuation">.</span>el <span class="token operator">=</span> oldVnode<span class="token punctuation">.</span>el
    <span class="token keyword">let</span> i<span class="token punctuation">,</span> oldCh <span class="token operator">=</span> oldVnode<span class="token punctuation">.</span>children<span class="token punctuation">,</span> ch <span class="token operator">=</span> vnode<span class="token punctuation">.</span>children
    <span class="token comment">// 情况一：引用一致，没有变化</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>oldVnode <span class="token operator">===</span> vnode<span class="token punctuation">)</span> <span class="token keyword">return</span>
    <span class="token comment">// 情况二：仅为文本节点发生变化，直接修改</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>oldVnode<span class="token punctuation">.</span>text <span class="token operator">!==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> vnode<span class="token punctuation">.</span>text <span class="token operator">!==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> oldVnode<span class="token punctuation">.</span>text <span class="token operator">!==</span> vnode<span class="token punctuation">.</span>text<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        api<span class="token punctuation">.</span><span class="token function">setTextContent</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> vnode<span class="token punctuation">.</span>text<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token function">updateEle</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> vnode<span class="token punctuation">,</span> oldVnode<span class="token punctuation">)</span>
        <span class="token comment">// 情况三：新、旧节点都有子节点，且不一样，调用updateChildren比较（Vue diff核心）</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>oldCh <span class="token operator">&amp;&amp;</span> ch <span class="token operator">&amp;&amp;</span> oldCh <span class="token operator">!==</span> ch<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">updateChildren</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> oldCh<span class="token punctuation">,</span> ch<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>ch<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// 情况四：只有新节点具有子节点，因为vnode.el引用了老的dom节点，createEle会在老dom上添加子节点</span>
            <span class="token function">createEle</span><span class="token punctuation">(</span>vnode<span class="token punctuation">)</span> <span class="token comment">//create el's children dom</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>oldCh<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// 情况五：只有老节点具有子节点，直接删除老节点</span>
            api<span class="token punctuation">.</span><span class="token function">removeChildren</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><h3 id="updatechildren"><a href="#updatechildren" class="header-anchor">#</a> updateChildren</h3> <p>当新、旧节点都 “具有不一样子节点” 时，调用 <code>updateChildren</code> 深入比较 <strong>（Vue diff核心）</strong>。</p> <p><strong>步骤</strong>：</p> <ul><li><code>oldCh</code> 和 <code>newCh</code> 各有 2 个头尾指针：<code>StartIdx</code> 和 <code>EndIdx</code></li> <li>依次进行4次比较：<strong>旧头新头、旧尾新尾、旧头新尾、旧尾新头</strong> 是否为 “同一类型节点”。若是，则证明 <strong>这一对节点值得比较</strong>，开始 <code>patchVnode</code></li> <li>若 4 次都匹配不上，开始比较<code>key</code>值</li> <li>会从 用 <code>key</code> 值生成的对象 <code>oldKeyToIdx</code> 中查找匹配节点</li> <li>最后变量会往中间靠拢，当 <code>StartIdx</code> &gt; <code>EndIdx</code> 时结束比较。</li></ul> <img src="/blog/assets/img/img-7.66473de8.png" width="400px"> <p><strong>总结遍历过程，有3种DOM操作</strong>：</p> <blockquote><p>oldVnode 对应的 Dom 总是存在，newVnode 的 dom 是不存在的。所以节点的移动只能采取 “移动到 旧尾后/旧头前”。</p></blockquote> <ul><li>当 <strong>旧头新尾</strong> 是 “同一类型节点”，说明 newVnode 右移了，所以 “旧头” 需要移动到 “旧尾” 后边</li> <li>当 <strong>旧尾新头</strong> 是 “统一类型节点”，说明 newVnode 左移了，所以 “旧尾” 需要移动到 “旧头” 前边</li> <li>当 某个节点 <code>newVnode</code> 有，但 <code>oldVnode</code> 没有，将 该节点 插入到 <code>旧头</code> 前边</li></ul> <p><strong>结束时，分2种情况</strong>：</p> <ul><li><code>oldStartIdx &gt; oldEndIdx</code>，表示<code>oldCh</code>先遍历完，此时<code>newStartIdx</code>和<code>newEndIdx</code>之间的vnode是新增的。此时，调用<code>addVnodes</code>，将 新节点 插入到 子节点 的末尾</li> <li><code>newStartIdx &gt; newEndIdx</code>，表示<code>newCh</code>先遍历完，此时<code>oldStartIdx</code>和<code>oldEndIdx</code>之间的vnode在新的节点里已经不存在了。此时，调用<code>removeVnodes</code>将它们从DOM里删除。</li></ul> <h3 id="总结vue-diff流程"><a href="#总结vue-diff流程" class="header-anchor">#</a> 总结Vue Diff流程</h3> <p><img src="/blog/assets/img/img-13.f4b785d9.png" alt="alt"></p> <h4 id="demo"><a href="#demo" class="header-anchor">#</a> Demo</h4> <p>当下面的结构的子节点的内容发生改变时：</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token comment">&lt;!-- 没有设置 key --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>parent<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- before --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>a<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>a<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>b<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>b<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>c<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>c<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>d<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>d<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>

    <span class="token comment">&lt;!-- after：变成了 b e d c --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>b<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>b<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>e<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>e<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>d<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>d<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>c<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>c<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>两组子节点如果发生改变，那 diff算法 的步骤也是不一样的。</p> <h3 id="没有设置key"><a href="#没有设置key" class="header-anchor">#</a> 没有设置key</h3> <p>对于 class 为 <code>parent</code> 这组节点：</p> <ul><li>执行<code>patch</code></li> <li>先从父节点开始，比较其 <code>oldVnode</code> 、 <code>newVnode</code> ，发现 <strong>值得比较</strong>。</li> <li>传入父节点的新、旧Vnode节点，执行 <code>patchVnode</code></li> <li>判断情况一：引用不一致，发生了变化</li> <li>判断情况二：不为文本节点，继续判断</li> <li>判断情况三：新、旧子节点都有各自且不同的子节点，调用 <code>updateChildren</code> 比较（Vue diff核心，即头尾的4次比较）</li> <li>开始遍历 新集合 中的节点</li> <li>对于<code>b</code>节点：
<ul><li>依次比较<code>旧头新头</code>、<code>旧尾新尾</code>、<code>旧头新尾</code>、<code>旧尾新头</code>，发现都不值得比较；</li> <li>开始比较<code>key</code></li> <li>发现<code>key</code>值不存在，执行<code>insertBefore</code>，将<code>新头</code>插入到<code>旧头</code>前面</li> <li><code>newStartIdx++</code>，新头下标继续往后。为<code>e</code>节点</li></ul></li> <li>对于<code>e</code>节点：
<ul><li>依次比较<code>旧头新头</code>、<code>旧尾新尾</code>、<code>旧头新尾</code>、<code>旧尾新头</code>，发现都不值得比较；</li> <li>开始比较<code>key</code></li> <li>发现<code>key</code>值不存在，执行<code>insertBefore</code>，将<code>新头</code>插入到<code>旧头</code>前面</li> <li><code>newStartIdx++</code>，新头下标继续往后。为<code>d</code>节点</li></ul></li> <li>对于<code>d</code>节点：
<ul><li>发现<code>旧尾新头</code>为同一类型节点，<strong>值得比较</strong>，说明 newVnode左移；</li> <li>开始执行<code>patchVnode</code>，发现引用一致没有变化，将<code>旧尾</code>插入到<code>旧头</code>前面</li> <li><code>newStartIdx++</code>、<code>oldEndIdx--</code>，新头下标继续往后、旧尾下标往前。此时新头为<code>c</code>，旧尾为<code>c</code></li></ul></li> <li>对于<code>c</code>节点：
<ul><li>发现<code>旧尾新头</code>为同一类型节点，<strong>值得比较</strong>，说明 newVnode左移；</li> <li>开始执行<code>patchVnode</code>，发现引用一致没有变化，将<code>旧尾</code>插入到<code>旧头</code>前面</li> <li><code>newStartIdx++</code>、<code>oldEndIdx--</code>，新头下标继续往后、旧尾下标往前。</li></ul></li> <li>此时<code>newStartIdx &gt; newEndIdx</code>，表示<code>newCh</code>先遍历完，此时<code>oldStartIdx</code>、<code>oldEndIdx</code>之间的节点<code>a</code>、<code>b</code>已经不存在了，调用<code>removeVnodes</code>将它们从DOM里删除</li></ul> <p><img src="/blog/assets/img/img-8.810efedd.png" alt="alt"></p> <h3 id="设置了key"><a href="#设置了key" class="header-anchor">#</a> 设置了key</h3> <blockquote><p>若设置了key值，b元素将得到复用。</p></blockquote> <ul><li>执行<code>patch</code></li> <li>先从父节点开始，比较其<code>oldVnode</code>、<code>newVnode</code>，发现<strong>值得比较</strong>。</li> <li>传入父节点的新、旧Vnode节点，执行<code>patchVnode</code></li> <li>判断情况一：引用不一致，发生了变化</li> <li>判断情况二：不为文本节点，继续判断</li> <li>判断情况三：新、旧子节点都有各自且不同的子节点，调用<code>updateChildren</code>比较（Vue diff核心，即头尾的4次比较）</li> <li>开始遍历 新集合 中的节点</li> <li>对于<code>b</code>节点：
<ul><li>依次比较<code>旧头新头</code>、<code>旧尾新尾</code>、<code>旧头新尾</code>、<code>旧尾新头</code>，发现都不值得比较；</li> <li><strong>开始比较<code>key</code></strong>（<code>key</code>值设置与否，不同在于这一步！！）</li> <li>发现<code>key</code>值在旧集合中，存在一个同<code>key</code>的下标，将旧集合中的该元素设为<code>elmToMove</code></li> <li>判断<code>elmToMove</code>和<code>新头</code>节点的选择器<code>sel</code>（因为<code>key</code>已经为相同）</li> <li>发现<code>sel</code>相同，表明他们<strong>值得比较</strong></li> <li>将旧集合对应节点设为<code>null</code>，并将<code>elmToMove</code>节点插入到<code>旧头</code>前</li> <li><code>newStartIdx++</code>，新头下标继续往后。为<code>e</code>节点</li></ul></li> <li>对于<code>e</code>节点：
<ul><li>依次比较<code>旧头新头</code>、<code>旧尾新尾</code>、<code>旧头新尾</code>、<code>旧尾新头</code>，发现都不值得比较；</li> <li>开始比较<code>key</code></li> <li>发现<code>key</code>值在旧集合中不存在，直接将<code>新头</code>插入到<code>旧头</code>前</li> <li><code>newStartIdx++</code>，新头下标继续往后。为<code>d</code>节点</li></ul></li> <li>对于<code>d</code>节点：
<ul><li>发现<code>旧尾新头</code>为同一类型节点，<strong>值得比较</strong>；</li> <li>开始执行<code>patchVnode</code>，发现引用一致没有变化，将<code>旧尾</code>插入到<code>旧头</code>前面</li> <li><code>newStartIdx++</code>、<code>oldEndIdx--</code>，新头下标继续往后、旧尾下标往前。此时新头为<code>c</code>，旧尾为<code>c</code></li></ul></li> <li>对于<code>c</code>节点：
<ul><li>发现<code>旧尾新头</code>为同一类型节点，<strong>值得比较</strong>；</li> <li>开始执行<code>patchVnode</code>，发现引用一致没有变化，将<code>旧尾</code>插入到<code>旧头</code>前面</li> <li><code>newStartIdx++</code>、<code>oldEndIdx--</code></li> <li>此时<code>newStartIdx &gt; newEndIdx</code>，表示<code>newCh</code>先遍历完，对于<code>oldStartIdx</code>、<code>oldEndIdx</code>之间的节点<code>a</code>、<code>b</code>已经不存在了，调用<code>removeVnodes</code>将它们从DOM里删除</li></ul></li></ul> <p><img src="/blog/assets/img/img-9.b0e0ec3d.png" alt="alt"></p> <h3 id="vue-updatechildren源码"><a href="#vue-updatechildren源码" class="header-anchor">#</a> vue updateChildren源码</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">updateChildren</span> <span class="token punctuation">(</span><span class="token parameter">parentElm<span class="token punctuation">,</span> oldCh<span class="token punctuation">,</span> newCh</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> oldStartIdx <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> newStartIdx <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">let</span> oldEndIdx <span class="token operator">=</span> oldCh<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span>
    <span class="token keyword">let</span> oldStartVnode <span class="token operator">=</span> oldCh<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    <span class="token keyword">let</span> oldEndVnode <span class="token operator">=</span> oldCh<span class="token punctuation">[</span>oldEndIdx<span class="token punctuation">]</span>
    <span class="token keyword">let</span> newEndIdx <span class="token operator">=</span> newCh<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span>
    <span class="token keyword">let</span> newStartVnode <span class="token operator">=</span> newCh<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    <span class="token keyword">let</span> newEndVnode <span class="token operator">=</span> newCh<span class="token punctuation">[</span>newEndIdx<span class="token punctuation">]</span>
    <span class="token keyword">let</span> oldKeyToIdx
    <span class="token keyword">let</span> idxInOld
    <span class="token keyword">let</span> elmToMove
    <span class="token keyword">let</span> before
    <span class="token keyword">while</span> <span class="token punctuation">(</span>oldStartIdx <span class="token operator">&lt;=</span> oldEndIdx <span class="token operator">&amp;&amp;</span> newStartIdx <span class="token operator">&lt;=</span> newEndIdx<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>oldStartVnode <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>   <span class="token comment">//对于vnode.key的比较，会把oldVnode = null</span>
                oldStartVnode <span class="token operator">=</span> oldCh<span class="token punctuation">[</span><span class="token operator">++</span>oldStartIdx<span class="token punctuation">]</span> 
            <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>oldEndVnode <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                oldEndVnode <span class="token operator">=</span> oldCh<span class="token punctuation">[</span><span class="token operator">--</span>oldEndIdx<span class="token punctuation">]</span>
            <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>newStartVnode <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                newStartVnode <span class="token operator">=</span> newCh<span class="token punctuation">[</span><span class="token operator">++</span>newStartIdx<span class="token punctuation">]</span>
            <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>newEndVnode <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                newEndVnode <span class="token operator">=</span> newCh<span class="token punctuation">[</span><span class="token operator">--</span>newEndIdx<span class="token punctuation">]</span>
            <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">sameVnode</span><span class="token punctuation">(</span>oldStartVnode<span class="token punctuation">,</span> newStartVnode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">patchVnode</span><span class="token punctuation">(</span>oldStartVnode<span class="token punctuation">,</span> newStartVnode<span class="token punctuation">)</span>
                oldStartVnode <span class="token operator">=</span> oldCh<span class="token punctuation">[</span><span class="token operator">++</span>oldStartIdx<span class="token punctuation">]</span>
                newStartVnode <span class="token operator">=</span> newCh<span class="token punctuation">[</span><span class="token operator">++</span>newStartIdx<span class="token punctuation">]</span>
            <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">sameVnode</span><span class="token punctuation">(</span>oldEndVnode<span class="token punctuation">,</span> newEndVnode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">patchVnode</span><span class="token punctuation">(</span>oldEndVnode<span class="token punctuation">,</span> newEndVnode<span class="token punctuation">)</span>
                oldEndVnode <span class="token operator">=</span> oldCh<span class="token punctuation">[</span><span class="token operator">--</span>oldEndIdx<span class="token punctuation">]</span>
                newEndVnode <span class="token operator">=</span> newCh<span class="token punctuation">[</span><span class="token operator">--</span>newEndIdx<span class="token punctuation">]</span>
            <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">sameVnode</span><span class="token punctuation">(</span>oldStartVnode<span class="token punctuation">,</span> newEndVnode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">patchVnode</span><span class="token punctuation">(</span>oldStartVnode<span class="token punctuation">,</span> newEndVnode<span class="token punctuation">)</span>
                api<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span>parentElm<span class="token punctuation">,</span> oldStartVnode<span class="token punctuation">.</span>el<span class="token punctuation">,</span> api<span class="token punctuation">.</span><span class="token function">nextSibling</span><span class="token punctuation">(</span>oldEndVnode<span class="token punctuation">.</span>el<span class="token punctuation">)</span><span class="token punctuation">)</span>
                oldStartVnode <span class="token operator">=</span> oldCh<span class="token punctuation">[</span><span class="token operator">++</span>oldStartIdx<span class="token punctuation">]</span>
                newEndVnode <span class="token operator">=</span> newCh<span class="token punctuation">[</span><span class="token operator">--</span>newEndIdx<span class="token punctuation">]</span>
            <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">sameVnode</span><span class="token punctuation">(</span>oldEndVnode<span class="token punctuation">,</span> newStartVnode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">patchVnode</span><span class="token punctuation">(</span>oldEndVnode<span class="token punctuation">,</span> newStartVnode<span class="token punctuation">)</span>
                api<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span>parentElm<span class="token punctuation">,</span> oldEndVnode<span class="token punctuation">.</span>el<span class="token punctuation">,</span> oldStartVnode<span class="token punctuation">.</span>el<span class="token punctuation">)</span>
                oldEndVnode <span class="token operator">=</span> oldCh<span class="token punctuation">[</span><span class="token operator">--</span>oldEndIdx<span class="token punctuation">]</span>
                newStartVnode <span class="token operator">=</span> newCh<span class="token punctuation">[</span><span class="token operator">++</span>newStartIdx<span class="token punctuation">]</span>
            <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span>
               <span class="token comment">// 使用key时的比较</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>oldKeyToIdx <span class="token operator">===</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    oldKeyToIdx <span class="token operator">=</span> <span class="token function">createKeyToOldIdx</span><span class="token punctuation">(</span>oldCh<span class="token punctuation">,</span> oldStartIdx<span class="token punctuation">,</span> oldEndIdx<span class="token punctuation">)</span> <span class="token comment">// 有key生成index表</span>
                <span class="token punctuation">}</span>
                idxInOld <span class="token operator">=</span> oldKeyToIdx<span class="token punctuation">[</span>newStartVnode<span class="token punctuation">.</span>key<span class="token punctuation">]</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>idxInOld<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    api<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span>parentElm<span class="token punctuation">,</span> <span class="token function">createEle</span><span class="token punctuation">(</span>newStartVnode<span class="token punctuation">)</span><span class="token punctuation">.</span>el<span class="token punctuation">,</span> oldStartVnode<span class="token punctuation">.</span>el<span class="token punctuation">)</span>
                    newStartVnode <span class="token operator">=</span> newCh<span class="token punctuation">[</span><span class="token operator">++</span>newStartIdx<span class="token punctuation">]</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    elmToMove <span class="token operator">=</span> oldCh<span class="token punctuation">[</span>idxInOld<span class="token punctuation">]</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>elmToMove<span class="token punctuation">.</span>sel <span class="token operator">!==</span> newStartVnode<span class="token punctuation">.</span>sel<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        api<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span>parentElm<span class="token punctuation">,</span> <span class="token function">createEle</span><span class="token punctuation">(</span>newStartVnode<span class="token punctuation">)</span><span class="token punctuation">.</span>el<span class="token punctuation">,</span> oldStartVnode<span class="token punctuation">.</span>el<span class="token punctuation">)</span>
                    <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span>
                        <span class="token function">patchVnode</span><span class="token punctuation">(</span>elmToMove<span class="token punctuation">,</span> newStartVnode<span class="token punctuation">)</span>
                        oldCh<span class="token punctuation">[</span>idxInOld<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">null</span>
                        api<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span>parentElm<span class="token punctuation">,</span> elmToMove<span class="token punctuation">.</span>el<span class="token punctuation">,</span> oldStartVnode<span class="token punctuation">.</span>el<span class="token punctuation">)</span>
                    <span class="token punctuation">}</span>
                    newStartVnode <span class="token operator">=</span> newCh<span class="token punctuation">[</span><span class="token operator">++</span>newStartIdx<span class="token punctuation">]</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>oldStartIdx <span class="token operator">&gt;</span> oldEndIdx<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            before <span class="token operator">=</span> newCh<span class="token punctuation">[</span>newEndIdx <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">?</span> <span class="token keyword">null</span> <span class="token operator">:</span> newCh<span class="token punctuation">[</span>newEndIdx <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>el
            <span class="token function">addVnodes</span><span class="token punctuation">(</span>parentElm<span class="token punctuation">,</span> before<span class="token punctuation">,</span> newCh<span class="token punctuation">,</span> newStartIdx<span class="token punctuation">,</span> newEndIdx<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>newStartIdx <span class="token operator">&gt;</span> newEndIdx<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">removeVnodes</span><span class="token punctuation">(</span>parentElm<span class="token punctuation">,</span> oldCh<span class="token punctuation">,</span> oldStartIdx<span class="token punctuation">,</span> oldEndIdx<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br></div></div><h2 id="四种diff算法总结"><a href="#四种diff算法总结" class="header-anchor">#</a> 四种Diff算法总结</h2> <ul><li><p><strong>传统Diff</strong>：</p> <ul><li>通过<strong>递归</strong>，对 HTML DOM树里的节点 进行依次对比。</li></ul></li> <li><p><strong>React Virtual DOM Diff</strong>：</p> <ul><li>基于三个策略 <strong>（不同层级、不同组件类型、不同key值都视作 “不同节点”）</strong></li> <li>依次根据 不同细粒度 （<code>tree</code>、<code>component</code>、<code>element</code>） 进行Diff
<ul><li><strong>tree diff</strong>：对树进行 <strong>同层比较</strong>。
<ul><li>【做法：如果是不同节点，则会直接销毁，不会进一步比较】</li></ul></li> <li><strong>component diff</strong>：根据组件 <strong>是否为同一类型</strong>，采取不同做法。
<ul><li>【做法1：对于 “同一类型的组件”，按照 <code>同层比较策略</code> 继续比较（也可通过 <code>shouldComponentUpdate()</code> 来跳过diff）】</li> <li>【做法2：对于 “不同类型的组件”，则替换整个组件】</li></ul></li> <li>element diff：根据新节点的 <code>key</code> 值、<code>该节点在旧集合位置</code> ，采取不同做法。
<ul><li>【做法：若 <code>“旧集合中不存在相同节点”</code>，则插入；</li> <li>【做法：若 <code>“旧集合中存在相同节点”</code>，比较 <code>当前节点在旧集合中的位置</code> 与 <code>访问过的节点在旧集合中最右的位置</code>：若当前节点在旧集合中的位置靠后，则不需移动；否则移动】</li></ul></li></ul></li></ul></li> <li><p><strong>Fiber Diff</strong>：</p> <ul><li>从链表头开始遍历</li> <li>对于每个节点，都与其 <code>alternate</code> 比较，并记录下需要更新的东西（作为<code>commit</code>），并把这些更新通过 <code>return</code> 提交到当前节点的父节点。</li> <li>当遍历完整个链表时，再通过 <code>return</code> 回溯到根节点。</li> <li>最后，所有的更新 都会带到 根节点，从而更新 真实的DOM 。</li></ul></li> <li><p><strong>Vue Virtual DOM Diff</strong>：</p> <ul><li>Vue只作 <strong>同层比较</strong>，且对于 <strong>不同类型的节点</strong> 会直接用新节点替换</li> <li>先让 <code>vnode.el</code> 引用真实dom（为了同步变化）后，开始比较<code>oldVnode</code>、<code>vnode</code></li> <li>依次判断 <strong>5类情况</strong>：
<ul><li>1、引用是否一致；【做法：不需改变】</li> <li>2、新旧都为文本节点【做法：只需修改text】</li> <li>3、新旧节点都有子节点，而且它们不一样【做法：执行<code>updateChildren</code>】<strong>（Vue Diff核心）</strong>；</li> <li>4、只有新节点有子节点；【做法：在老节点上添加新节点】</li> <li>5、只有旧节点有子节点，新节点没有子节点。【做法：直接删除老节点】</li></ul></li> <li>在<code>updateChildren</code>的过程中，<code>oldCh</code>、<code>newCh</code>会进行 <strong>头尾两端的相互比较</strong> （即：旧头新头、旧尾新尾、旧头新尾、旧尾新头）。若设置<code>key</code>，会多了一步“查找匹配节点”</li> <li>最后指针会往中间靠拢，直到结束</li></ul></li></ul> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <ul><li><p>对于“同一类型”这个说法，React会认为“两节点是同一个组件类的不同实例、相同HTML标签”这类”是属于同一类型；Vue会认为“两节点的key &amp;&amp; sel相同”时是属于同一类型。</p></li> <li><p>另外，vue中在使用相同标签名元素的 <strong>过渡切换</strong> 时，<strong>需用不同key值作区分</strong>。否则vue只会替换其内部属性而不会触发过渡效果。</p></li> <li><p>真实 DOM 慢就慢在 <strong>会导致浏览器重排、重绘</strong></p></li> <li><p>React的优势在于 “以最小的代价更新 DOM”</p></li></ul></div> <h2 id="参考链接"><a href="#参考链接" class="header-anchor">#</a> 参考链接</h2> <ul><li><a href="https://zhuanlan.zhihu.com/p/20346379" target="_blank" rel="noopener noreferrer">React 源码剖析系列 － 不可思议的 react diff<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://cloud.tencent.com/developer/article/1402610" target="_blank" rel="noopener noreferrer">谈谈React中Diff算法的策略及实现<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="http://www.ptbird.cn/react-diff-from-code.html" target="_blank" rel="noopener noreferrer">React diff 策略<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://cloud.tencent.com/developer/article/1477707" target="_blank" rel="noopener noreferrer">详解 React 16 的 Diff 策略<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://segmentfault.com/a/1190000018488975" target="_blank" rel="noopener noreferrer">React16性能改善的原理（二）<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">更新时间:</span> <span class="time">11/7/2021, 7:39:37 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/blog/skill/web/ssr/" class="prev">
        浏览器/服务端渲染
      </a></span> <span class="next"><a href="/blog/skill/web/web-attack/">
        XSS、CSRF、SQL注入
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/blog/assets/js/app.d63006d9.js" defer></script><script src="/blog/assets/js/2.9a5e99eb.js" defer></script><script src="/blog/assets/js/3.fa7434c4.js" defer></script>
  </body>
</html>

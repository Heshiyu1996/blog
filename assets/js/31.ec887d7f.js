(window.webpackJsonp=window.webpackJsonp||[]).push([[31],{408:function(t,e,a){t.exports=a.p+"assets/img/browser-cache-1.cc287965.png"},409:function(t,e,a){t.exports=a.p+"assets/img/browser-cache-2.287bfcb5.png"},410:function(t,e,a){t.exports=a.p+"assets/img/browser-cache-3.7835cc64.png"},580:function(t,e,a){"use strict";a.r(e);var r=a(29),_=Object(r.a)({},(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[r("h1",{attrs:{id:"浏览器缓存机制"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#浏览器缓存机制"}},[t._v("#")]),t._v(" 浏览器缓存机制")]),t._v(" "),r("blockquote",[r("p",[t._v("缓存和重用之前获取的资源对于性能优化很关键。\n")]),r("div",{staticClass:"table-of-contents"},[r("ul",[r("li",[r("a",{attrs:{href:"#浏览器缓存机制"}},[t._v("浏览器缓存机制")]),r("ul",[r("li",[r("a",{attrs:{href:"#缓存的分类"}},[t._v("缓存的分类")])]),r("li",[r("a",{attrs:{href:"#字段说明"}},[t._v("字段说明")])]),r("li",[r("a",{attrs:{href:"#cdn缓存"}},[t._v("CDN缓存")])]),r("li",[r("a",{attrs:{href:"#from-memory-cache与from-disk-cache"}},[t._v("from memory cache与from disk cache")])]),r("li",[r("a",{attrs:{href:"#拓展-在-html的meta里设置缓存策略"}},[t._v("拓展：在.html的meta里设置缓存策略")])]),r("li",[r("a",{attrs:{href:"#拓展-chrome86启用缓存分区"}},[t._v("拓展：Chrome86启用缓存分区")])]),r("li",[r("a",{attrs:{href:"#参考链接"}},[t._v("参考链接")])])])])])]),r("p")]),t._v(" "),r("h2",{attrs:{id:"缓存的分类"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#缓存的分类"}},[t._v("#")]),t._v(" 缓存的分类")]),t._v(" "),r("p",[t._v("按照存储的位置，可以分为：\n优先级越往上越高：")]),t._v(" "),r("ul",[r("li",[t._v("Service Worker")]),t._v(" "),r("li",[t._v("Memory Cache")]),t._v(" "),r("li",[t._v("Disk Cache")]),t._v(" "),r("li",[t._v("Network Request")])]),t._v(" "),r("blockquote",[r("p",[r("code",[t._v("Service Worker")]),t._v("是一个注册在指定源和路径下事件驱动的独立线程。采用JavaScript控制关联的页面或网站资源，拦截并修改访问和资源请求，更精细地缓存资源。")]),t._v(" "),r("p",[t._v("（只能针对https）")])]),t._v(" "),r("h2",{attrs:{id:"字段说明"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#字段说明"}},[t._v("#")]),t._v(" 字段说明")]),t._v(" "),r("h3",{attrs:{id:"强缓存"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#强缓存"}},[t._v("#")]),t._v(" 强缓存")]),t._v(" "),r("p",[r("strong",[t._v("Response Header")])]),t._v(" "),r("p",[t._v("优先级从高到低：")]),t._v(" "),r("table",[r("thead",[r("tr",[r("th",[t._v("字段名称")]),t._v(" "),r("th",{staticStyle:{"text-align":"center"}},[t._v("说明")]),t._v(" "),r("th",{staticStyle:{"text-align":"center"}},[t._v("适用http版本")]),t._v(" "),r("th",{staticStyle:{"text-align":"center"}},[t._v("特点")])])]),t._v(" "),r("tbody",[r("tr",[r("td",[t._v("Pragma")]),t._v(" "),r("td",{staticStyle:{"text-align":"center"}},[t._v("值为"),r("code",[t._v("no-cache")]),t._v("时，表示禁用缓存")]),t._v(" "),r("td",{staticStyle:{"text-align":"center"}},[t._v("1.0、1.1")]),t._v(" "),r("td",{staticStyle:{"text-align":"center"}},[t._v("优先级最高")])]),t._v(" "),r("tr",[r("td",[t._v("Cache-Control")]),t._v(" "),r("td",{staticStyle:{"text-align":"center"}},[t._v("值为缓存过期时间")]),t._v(" "),r("td",{staticStyle:{"text-align":"center"}},[r("strong",[t._v("仅1.1")])]),t._v(" "),r("td",{staticStyle:{"text-align":"center"}},[t._v("配置选项较多")])]),t._v(" "),r("tr",[r("td",[t._v("Expires")]),t._v(" "),r("td",{staticStyle:{"text-align":"center"}},[t._v("值为缓存过期时间")]),t._v(" "),r("td",{staticStyle:{"text-align":"center"}},[t._v("1.0、1.1")]),t._v(" "),r("td",{staticStyle:{"text-align":"center"}},[t._v("服务器、客户端时间可能对不上")])])])]),t._v(" "),r("p",[t._v("注意：")]),t._v(" "),r("ul",[r("li",[t._v("因为"),r("code",[t._v("Expires")]),t._v("既适用于1.0，也适用于1.1，所以大多数情况下会同时发送"),r("code",[t._v("Expires")]),t._v("、"),r("code",[t._v("Cache-Control")])])]),t._v(" "),r("h4",{attrs:{id:"cache-control选项说明"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#cache-control选项说明"}},[t._v("#")]),t._v(" Cache-Control选项说明")]),t._v(" "),r("p",[t._v("在"),r("strong",[t._v("Request Header")]),t._v("、"),r("strong",[t._v("Response Header")]),t._v("都可以使用"),r("code",[t._v("Cache-Control")]),t._v("，区别在于：")]),t._v(" "),r("ul",[r("li",[t._v("前者：声明"),r("strong",[t._v("本次")]),t._v("请求的缓存策略；")]),t._v(" "),r("li",[t._v("后者："),r("strong",[t._v("浏览器会判别这些响应值来决定资源缓存的状态")])])]),t._v(" "),r("p",[t._v("在"),r("strong",[t._v("Request Header")]),t._v("中使用：\n"),r("img",{attrs:{src:a(408),alt:"alt"}})]),t._v(" "),r("p",[t._v("在"),r("strong",[t._v("Response Header")]),t._v("中使用：\n"),r("img",{attrs:{src:a(409),alt:"alt"}})]),t._v(" "),r("h3",{attrs:{id:"协商缓存"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#协商缓存"}},[t._v("#")]),t._v(" 协商缓存")]),t._v(" "),r("p",[r("strong",[t._v("Response Header")])]),t._v(" "),r("table",[r("thead",[r("tr",[r("th",[t._v("字段名称")]),t._v(" "),r("th",{staticStyle:{"text-align":"center"}},[t._v("说明")]),t._v(" "),r("th",{staticStyle:{"text-align":"center"}},[t._v("适用http版本")]),t._v(" "),r("th",{staticStyle:{"text-align":"center"}},[t._v("特点")])])]),t._v(" "),r("tbody",[r("tr",[r("td",[t._v("Last-Modified")]),t._v(" "),r("td",{staticStyle:{"text-align":"center"}},[t._v("文件的最后一次修改时间")]),t._v(" "),r("td",{staticStyle:{"text-align":"center"}},[t._v("1.0、1.1")]),t._v(" "),r("td",{staticStyle:{"text-align":"center"}},[t._v("无法判断“小于秒级”、“周期性更改”的文件")])]),t._v(" "),r("tr",[r("td",[t._v("ETag")]),t._v(" "),r("td",{staticStyle:{"text-align":"center"}},[t._v("资源的唯一标识符")]),t._v(" "),r("td",{staticStyle:{"text-align":"center"}},[r("strong",[t._v("仅1.1")])]),t._v(" "),r("td",{staticStyle:{"text-align":"center"}},[t._v("计算会产生服务器性能损耗")])])])]),t._v(" "),r("p",[r("strong",[t._v("Request Header")])]),t._v(" "),r("table",[r("thead",[r("tr",[r("th",[t._v("字段名称")]),t._v(" "),r("th",{staticStyle:{"text-align":"center"}},[t._v("说明")]),t._v(" "),r("th",{staticStyle:{"text-align":"center"}},[t._v("适用http版本")])])]),t._v(" "),r("tbody",[r("tr",[r("td",[t._v("If-Modified-Since")]),t._v(" "),r("td",{staticStyle:{"text-align":"center"}},[t._v("向服务器请求上次保存的"),r("code",[t._v("Last-Modified")]),t._v("值")]),t._v(" "),r("td",{staticStyle:{"text-align":"center"}},[t._v("1.0、1.1")])]),t._v(" "),r("tr",[r("td",[t._v("If-None-Match")]),t._v(" "),r("td",{staticStyle:{"text-align":"center"}},[t._v("向服务器请求上次保存的"),r("code",[t._v("ETag")]),t._v("值")]),t._v(" "),r("td",{staticStyle:{"text-align":"center"}},[r("strong",[t._v("仅1.1")])])])])]),t._v(" "),r("h3",{attrs:{id:"浏览器的应对"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#浏览器的应对"}},[t._v("#")]),t._v(" 浏览器的应对")]),t._v(" "),r("p",[t._v("服务器会在资源返回的响应中，携带以上四个常用（Cache-Control、Expires、Last-Modified、ETag）的响应头。"),r("strong",[t._v("浏览器会通过判别这些响应值来决定资源缓存的状态。")])]),t._v(" "),r("p",[t._v("当响应中有"),r("code",[t._v("Cache-Control")]),t._v("（设置了"),r("code",[t._v("max-age")]),t._v("），或者"),r("code",[t._v("Expires")]),t._v("，浏览器不会向服务器发起校验请求而是直接使用本地缓存。")]),t._v(" "),r("blockquote",[r("p",[t._v("在这段时间里，只能通过"),r("strong",[t._v("强制刷新")]),t._v("来请求最新资源(前提是没有接入CDN)")])]),t._v(" "),r("div",{staticClass:"custom-block tip"},[r("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),r("table",[r("thead",[r("tr",[r("th",[t._v("刷新行为")]),t._v(" "),r("th",{staticStyle:{"text-align":"center"}},[r("code",[t._v("Request Header")]),t._v("会携带")])])]),t._v(" "),r("tbody",[r("tr",[r("td",[t._v("F5、工具栏的刷新按钮")]),t._v(" "),r("td",{staticStyle:{"text-align":"center"}},[r("strong",[t._v("If-Modified-Since")]),t._v("（如果上次Response里有"),r("code",[t._v("Last-Modified")]),t._v("）、"),r("strong",[t._v("If-None-Match")]),t._v("（如果上次Response里有"),r("code",[t._v("ETag")]),t._v("）")])]),t._v(" "),r("tr",[r("td",[t._v("Ctrl + F5")]),t._v(" "),r("td",{staticStyle:{"text-align":"center"}},[r("strong",[t._v("Pragma: no-cache")]),t._v("、"),r("strong",[t._v("Cache-Control: no-cache")])])])])])]),t._v(" "),r("h2",{attrs:{id:"cdn缓存"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#cdn缓存"}},[t._v("#")]),t._v(" CDN缓存")]),t._v(" "),r("p",[t._v("如果接入了CDN，即使强制刷新，也不会直接向源服务器请求资源，而是转向CDN边缘节点请求资源。")]),t._v(" "),r("blockquote",[r("p",[t._v("除非CDN边缘节点的缓存也过期了，CDN边缘节点才会向源服务器发请求，从而获取最新资源。")])]),t._v(" "),r("p",[t._v("优势")]),t._v(" "),r("ul",[r("li",[t._v("减少用户访问延时")]),t._v(" "),r("li",[t._v("减少源服务器的负载")])]),t._v(" "),r("h2",{attrs:{id:"from-memory-cache与from-disk-cache"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#from-memory-cache与from-disk-cache"}},[t._v("#")]),t._v(" from memory cache与from disk cache")]),t._v(" "),r("p",[t._v("Network的Size栏会有三种情况：")]),t._v(" "),r("ul",[r("li",[t._v("from memory cache")]),t._v(" "),r("li",[t._v("from disk cache")]),t._v(" "),r("li",[t._v("资源大小\n"),r("img",{attrs:{src:a(410),alt:"alt"}})])]),t._v(" "),r("table",[r("thead",[r("tr",[r("th",[t._v("状态")]),t._v(" "),r("th",{staticStyle:{"text-align":"center"}},[t._v("类型")]),t._v(" "),r("th",{staticStyle:{"text-align":"center"}},[t._v("说明")])])]),t._v(" "),r("tbody",[r("tr",[r("td",[t._v("200")]),t._v(" "),r("td",{staticStyle:{"text-align":"center"}},[t._v("from memory cache")]),t._v(" "),r("td",{staticStyle:{"text-align":"center"}},[t._v("不访问服务器，缓存在"),r("strong",[t._v("内存")]),t._v("中。浏览器关闭后，数据"),r("strong",[t._v("将被释放")]),t._v("（一般为js、图片）")])]),t._v(" "),r("tr",[r("td",[t._v("200")]),t._v(" "),r("td",{staticStyle:{"text-align":"center"}},[t._v("from disk cache")]),t._v(" "),r("td",{staticStyle:{"text-align":"center"}},[t._v("不访问服务器。缓存在"),r("strong",[t._v("硬盘")]),t._v("中。浏览器关闭后，数据"),r("strong",[t._v("依然存在")]),t._v("（一般为css）")])]),t._v(" "),r("tr",[r("td",[t._v("304")]),t._v(" "),r("td",{staticStyle:{"text-align":"center"}},[t._v("资源大小")]),t._v(" "),r("td",{staticStyle:{"text-align":"center"}},[t._v("命中"),r("strong",[t._v("协商缓存")]),t._v("，使用本地资源（CDN上的资源）")])])])]),t._v(" "),r("h2",{attrs:{id:"拓展-在-html的meta里设置缓存策略"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#拓展-在-html的meta里设置缓存策略"}},[t._v("#")]),t._v(" 拓展：在.html的meta里设置缓存策略")]),t._v(" "),r("p",[t._v("（待更新...）")]),t._v(" "),r("h2",{attrs:{id:"拓展-chrome86启用缓存分区"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#拓展-chrome86启用缓存分区"}},[t._v("#")]),t._v(" 拓展：Chrome86启用缓存分区")]),t._v(" "),r("ul",[r("li",[t._v("浏览器缓存机制的改变（新增2个缓存key）")]),t._v(" "),r("li",[t._v("避免攻击者利用“检查缓存”实施攻击")])]),t._v(" "),r("h2",{attrs:{id:"参考链接"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#参考链接"}},[t._v("#")]),t._v(" 参考链接")]),t._v(" "),r("ul",[r("li",[r("a",{attrs:{href:"https://imweb.io/topic/5795dcb6fb312541492eda8c",target:"_blank",rel:"noopener noreferrer"}},[t._v("HTTP缓存控制小结"),r("OutboundLink")],1)]),t._v(" "),r("li",[r("a",{attrs:{href:"https://segmentfault.com/q/1010000013464267",target:"_blank",rel:"noopener noreferrer"}},[t._v("from memory cache与from disk cache"),r("OutboundLink")],1)]),t._v(" "),r("li",[r("a",{attrs:{href:"https://juejin.im/post/5e7ef4a9e51d4546f8784b21",target:"_blank",rel:"noopener noreferrer"}},[t._v("前端缓存那些事"),r("OutboundLink")],1)]),t._v(" "),r("li",[r("a",{attrs:{href:"https://juejin.im/post/6844903844044865550",target:"_blank",rel:"noopener noreferrer"}},[t._v("聊聊 CDN 缓存与浏览器缓存"),r("OutboundLink")],1)]),t._v(" "),r("li",[r("a",{attrs:{href:"https://mp.weixin.qq.com/s/8oL4Z4ewTl0VbQ_0BH4n7w",target:"_blank",rel:"noopener noreferrer"}},[t._v("新的浏览器缓存策略变更：舍弃性能、确保安全"),r("OutboundLink")],1)]),t._v(" "),r("li",[r("a",{attrs:{href:"https://www.chromestatus.com/feature/5730772021411840",target:"_blank",rel:"noopener noreferrer"}},[t._v("Partition the HTTP Cache"),r("OutboundLink")],1)])])])}),[],!1,null,null,null);e.default=_.exports}}]);
(window.webpackJsonp=window.webpackJsonp||[]).push([[180],{727:function(t,s,a){"use strict";a.r(s);var e=a(43),r=Object(e.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"xss、csrf、sql注入"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#xss、csrf、sql注入"}},[t._v("#")]),t._v(" XSS、CSRF、SQL注入")]),t._v(" "),a("p",[t._v("针对Web服务器的攻击，常见的有："),a("code",[t._v("XSS（跨站脚本攻击）")]),t._v("、"),a("code",[t._v("CSRF（跨站请求伪造）")]),t._v("、"),a("code",[t._v("SQL注入")])]),a("div",{staticClass:"table-of-contents"},[a("ul",[a("li",[a("a",{attrs:{href:"#xss、csrf、sql注入"}},[t._v("XSS、CSRF、SQL注入")]),a("ul",[a("li",[a("a",{attrs:{href:"#xss-跨站脚本攻击"}},[t._v("XSS（跨站脚本攻击）")])]),a("li",[a("a",{attrs:{href:"#csrf-跨站请求伪造-cross-site-request-forgery"}},[t._v("CSRF（跨站请求伪造，Cross-Site Request Forgery）")])]),a("li",[a("a",{attrs:{href:"#sql注入"}},[t._v("SQL注入")])])])])])]),a("p"),t._v(" "),a("h2",{attrs:{id:"xss-跨站脚本攻击"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#xss-跨站脚本攻击"}},[t._v("#")]),t._v(" XSS（跨站脚本攻击）")]),t._v(" "),a("p",[t._v("攻击者 "),a("strong",[t._v("将恶意代码注入到网页")]),t._v(" 上，使得用户不经意地加载并执行。")]),t._v(" "),a("h3",{attrs:{id:"xss类别"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#xss类别"}},[t._v("#")]),t._v(" XSS类别")]),t._v(" "),a("p",[t._v("常见的有：反射性攻击、存储型攻击。")]),t._v(" "),a("h4",{attrs:{id:"反射型攻击"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#反射型攻击"}},[t._v("#")]),t._v(" 反射型攻击")]),t._v(" "),a("p",[t._v("恶意代码被嵌到 url参数。")]),t._v(" "),a("p",[t._v("1、 攻击者B 向 用户C 发送一个“改装过的url”")]),t._v(" "),a("blockquote",[a("p",[t._v("例如："),a("code",[t._v("http://www.some.site/page.html?default=<script>alert(document.cookie)<\/script>")])])]),t._v(" "),a("p",[t._v("2、 网站A "),a("code",[t._v("从URL的参数")]),t._v("中取出恶意代码，并显示在屏幕上。")]),t._v(" "),a("blockquote",[a("p",[t._v("如：需要将一些"),a("strong",[t._v("错误信息、搜索结果")]),t._v("直接显示在页面上时")])]),t._v(" "),a("h4",{attrs:{id:"存储型攻击"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#存储型攻击"}},[t._v("#")]),t._v(" 存储型攻击")]),t._v(" "),a("p",[t._v("恶意代码被保存到 服务器。")]),t._v(" "),a("p",[t._v("1、 攻击者B 在 网站A 留下恶意评论；")]),t._v(" "),a("p",[t._v("2、 用户C 访问 网站A时，加载了 攻击者B 的评论")]),t._v(" "),a("blockquote",[a("p",[t._v("如："),a("strong",[t._v("评论、博客、私信")])])]),t._v(" "),a("h3",{attrs:{id:"防御手段"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#防御手段"}},[t._v("#")]),t._v(" 防御手段")]),t._v(" "),a("p",[t._v("分别从 3 个方面：用户输入、Cookie凭证、资源加载。")]),t._v(" "),a("h4",{attrs:{id:"用户输入"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#用户输入"}},[t._v("#")]),t._v(" 用户输入")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("过滤")]),t._v("。对敏感参数直接进行过滤。（在提交表单、传递url参数之前）")]),t._v(" "),a("li",[a("code",[t._v("转义")]),t._v("。对用户输入的数据进行转义。\n"),a("blockquote",[a("p",[t._v("1、"),a("code",[t._v("在React中使用JSX")]),t._v("。因为React DOM会使得所有内容在渲染前，都会被"),a("strong",[t._v("转换成字符串")]),t._v("。")]),t._v(" "),a("p",[t._v("2、"),a("a",{attrs:{href:"#%E5%B8%B8%E7%94%A8%E8%BD%AC%E4%B9%89%E8%A7%84%E5%88%99"}},[t._v("常用转义规则")])])])])]),t._v(" "),a("h4",{attrs:{id:"cookie凭证"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#cookie凭证"}},[t._v("#")]),t._v(" Cookie凭证")]),t._v(" "),a("p",[a("code",[t._v("httpOnly")]),t._v("：防止浏览器通过 "),a("code",[t._v("document.cookie")]),t._v(" 读取 cookie。")]),t._v(" "),a("h4",{attrs:{id:"资源加载"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#资源加载"}},[t._v("#")]),t._v(" 资源加载")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("Content-Type: application/json; charset=utf-8")]),t._v(" "),a("blockquote",[a("p",[t._v("1、避免输出内容被HTML解析")]),t._v(" "),a("p",[t._v("2、不使用：Content-Type: text/html; charset=utf-8")])])]),t._v(" "),a("li",[a("code",[t._v("Content-Security-Policy")]),t._v("。\n"),a("blockquote",[a("p",[t._v("让网站管理者去声明："),a("strong",[t._v("在指定页面中，浏览器能够加载哪些资源")]),t._v("。")])])])]),t._v(" "),a("h3",{attrs:{id:"常用转义规则"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#常用转义规则"}},[t._v("#")]),t._v(" 常用转义规则")]),t._v(" "),a("p",[t._v("以 “&” 开头，以 “;” 结尾")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("转义前")]),t._v(" "),a("th",{staticStyle:{"text-align":"center"}},[t._v("转义后")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("&")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[a("code",[t._v("&amp;")])])]),t._v(" "),a("tr",[a("td",[t._v("<")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[a("code",[t._v("&lt;")])])]),t._v(" "),a("tr",[a("td",[t._v(">")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[a("code",[t._v("&gt;")])])]),t._v(" "),a("tr",[a("td",[t._v('"')]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[a("code",[t._v("&quot;")])])]),t._v(" "),a("tr",[a("td",[t._v("'")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[a("code",[t._v("&#x27;")])])]),t._v(" "),a("tr",[a("td",[t._v("/")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[a("code",[t._v("&#x2F;")])])])])]),t._v(" "),a("h3",{attrs:{id:"恶意代码示例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#恶意代码示例"}},[t._v("#")]),t._v(" 恶意代码示例")]),t._v(" "),a("div",{staticClass:"language-html line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-html"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!-- 反射型：提前结束尾标签，拼接新标签 --\x3e")]),t._v("\n>"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token script"}},[a("span",{pre:!0,attrs:{class:"token language-javascript"}},[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("alert")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("document"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cookie"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")])])]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!-- 存储型：在 <img> 的 src 内置代码 --\x3e")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("img")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("src")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("javascript:alert("),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("'")]),t._v("XSS"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("'")]),t._v(")"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!-- 存储型：在 <img> 的 onerror处 内置代码 --\x3e")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("img")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("src")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("http://888.888.com/999.png"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("onerror")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("alert("),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("'")]),t._v("XSS"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("'")]),t._v(")"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br")])]),a("h2",{attrs:{id:"csrf-跨站请求伪造-cross-site-request-forgery"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#csrf-跨站请求伪造-cross-site-request-forgery"}},[t._v("#")]),t._v(" CSRF（跨站请求伪造，Cross-Site Request Forgery）")]),t._v(" "),a("p",[t._v("攻击者通过"),a("strong",[t._v("欺骗用户的浏览器")]),t._v("，"),a("strong",[t._v("以用户的名义")]),t._v("去执行恶意操作。")]),t._v(" "),a("blockquote",[a("p",[t._v("由于浏览器的机制，当请求某个域名的接口时，会把关联的cookie（存在本地磁盘、且未过期）一起带过去。")])]),t._v(" "),a("h3",{attrs:{id:"攻击方式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#攻击方式"}},[t._v("#")]),t._v(" 攻击方式：")]),t._v(" "),a("ul",[a("li",[t._v("1、在用户成功登录"),a("code",[t._v("网站A")]),t._v("的情况下，攻击者诱导用户进入"),a("code",[t._v("网站B")]),t._v("；")]),t._v(" "),a("li",[t._v("2、在网站B中，攻击者的脚本“偷偷”向"),a("code",[t._v("网站A")]),t._v("发请求；")])]),t._v(" "),a("p",[t._v("结果："),a("strong",[t._v("网站A认为是用户本人发出，接受请求。")])]),t._v(" "),a("h3",{attrs:{id:"防御手段-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#防御手段-2"}},[t._v("#")]),t._v(" 防御手段：")]),t._v(" "),a("p",[t._v("分别从 "),a("strong",[t._v("跨站")]),t._v("、"),a("strong",[t._v("csrfToken")]),t._v(" 进行防御。")]),t._v(" "),a("h4",{attrs:{id:"跨站"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#跨站"}},[t._v("#")]),t._v(" 跨站")]),t._v(" "),a("h5",{attrs:{id:"检查请求的referer字段"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#检查请求的referer字段"}},[t._v("#")]),t._v(" 检查请求的Referer字段")]),t._v(" "),a("p",[a("code",[t._v("Referer")]),t._v("可以表示请求来源于哪个地址，所以可以用来判断"),a("strong",[t._v("请求是否从本站发出")]),t._v("。")]),t._v(" "),a("blockquote",[a("p",[t._v("缺点：要正确判断"),a("code",[t._v("是否为合法请求源")]),t._v("不容易")])]),t._v(" "),a("h5",{attrs:{id:"检查cookie的samesite属性"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#检查cookie的samesite属性"}},[t._v("#")]),t._v(" 检查Cookie的SameSite属性")]),t._v(" "),a("p",[t._v("使用Cookie的"),a("strong",[t._v("SameSite")]),t._v("属性（表明跨站点时能否访问该cookie）")]),t._v(" "),a("blockquote",[a("p",[t._v("2019年，Google提出的新cookie标准，为防止CSRF提供了第一道防线")])]),t._v(" "),a("h4",{attrs:{id:"token"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#token"}},[t._v("#")]),t._v(" Token")]),t._v(" "),a("h5",{attrs:{id:"设置token并验证"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#设置token并验证"}},[t._v("#")]),t._v(" 设置Token并验证")]),t._v(" "),a("p",[t._v("Token + cookie + 校验“请求体“与“请求头cookie”")]),t._v(" "),a("blockquote",[a("p",[t._v("原因：攻击者只能利用，但并不能获取用户的cookie")])]),t._v(" "),a("ol",[a("li",[t._v("用户请求登录接口")]),t._v(" "),a("li",[t._v("服务端收到请求，生成随机的Token，并通过响应头"),a("code",[t._v("Set-Cookie")]),t._v("下发")]),t._v(" "),a("li",[t._v("网站A 解析"),a("code",[t._v("cookie")]),t._v("，把"),a("code",[t._v("Token")]),t._v("放到"),a("strong",[t._v("请求体")]),t._v("（或"),a("strong",[t._v("请求头")]),t._v("的自定义属性），和其它参数一起提交请求")]),t._v(" "),a("li",[t._v("服务端检查 "),a("strong",[t._v("cookie里的Token")]),t._v(" 与"),a("strong",[t._v("请求体")]),t._v("（或"),a("strong",[t._v("请求头")]),t._v("的自定义属性）中的Token是否一致")])]),t._v(" "),a("h5",{attrs:{id:"使用图片验证码"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用图片验证码"}},[t._v("#")]),t._v(" 使用图片验证码")]),t._v(" "),a("h2",{attrs:{id:"sql注入"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#sql注入"}},[t._v("#")]),t._v(" SQL注入")]),t._v(" "),a("p",[t._v("攻击者 把SQL命令 "),a("strong",[t._v("通过表单输入框提交")]),t._v("，以 "),a("strong",[t._v("欺骗")]),t._v(" 服务器执行恶意的SQL命令。")]),t._v(" "),a("h3",{attrs:{id:"防止手段"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#防止手段"}},[t._v("#")]),t._v(" 防止手段")]),t._v(" "),a("p",[t._v("对用户的输入进行"),a("strong",[t._v("检查、过滤")]),t._v("。")])])}),[],!1,null,null,null);s.default=r.exports}}]);
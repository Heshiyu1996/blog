(window.webpackJsonp=window.webpackJsonp||[]).push([[38],{334:function(_,v,e){_.exports=e.p+"assets/img/img-6.fe946c2b.png"},335:function(_,v,e){_.exports=e.p+"assets/img/img-9.95f354e6.png"},542:function(_,v,e){"use strict";e.r(v);var o=e(29),s=Object(o.a)({},(function(){var _=this,v=_.$createElement,o=_._self._c||v;return o("ContentSlotsDistributor",{attrs:{"slot-key":_.$parent.slotKey}},[o("h1",{attrs:{id:"觅见日记-小程序"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#觅见日记-小程序"}},[_._v("#")]),_._v(" 觅见日记（小程序）")]),_._v(" "),o("blockquote",[o("p",[_._v("项目时间：2018-07 ~ 2018-09")])]),_._v(" "),o("p"),o("div",{staticClass:"table-of-contents"},[o("ul",[o("li",[o("a",{attrs:{href:"#觅见日记-小程序"}},[_._v("觅见日记（小程序）")]),o("ul",[o("li",[o("a",{attrs:{href:"#职责"}},[_._v("职责")])]),o("li",[o("a",{attrs:{href:"#亮点"}},[_._v("亮点")])]),o("li",[o("a",{attrs:{href:"#难点"}},[_._v("难点")])])])])])]),o("p"),_._v(" "),o("p",[o("img",{attrs:{src:e(334),alt:"alt"}})]),_._v(" "),o("h2",{attrs:{id:"职责"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#职责"}},[_._v("#")]),_._v(" 职责")]),_._v(" "),o("ul",[o("li",[_._v("微信登录/授权部分")]),_._v(" "),o("li",[_._v("调研并引入fly.js")]),_._v(" "),o("li",[_._v("前端资源模块化")]),_._v(" "),o("li",[_._v("UI设计")])]),_._v(" "),o("h2",{attrs:{id:"亮点"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#亮点"}},[_._v("#")]),_._v(" 亮点")]),_._v(" "),o("ul",[o("li",[_._v("请求响应统一拦截配置\n"),o("ul",[o("li",[_._v("根据不同的code对响应进行不同的逻辑处理")])])]),_._v(" "),o("li",[_._v("LS以及Vuex巧妙搭配\n"),o("ul",[o("li",[_._v("LS作为存储方、Vuex作为提供方")])])])]),_._v(" "),o("h2",{attrs:{id:"难点"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#难点"}},[_._v("#")]),_._v(" 难点")]),_._v(" "),o("ul",[o("li",[o("a",{attrs:{href:"#%E7%99%BB%E5%BD%95%E6%80%81%E3%80%81userinfo%E7%9A%84%E8%8E%B7%E5%8F%96%E4%B8%8E%E5%AD%98%E5%82%A8"}},[_._v("登录态、userInfo的获取与存储")])]),_._v(" "),o("li",[o("a",{attrs:{href:"#%E7%99%BB%E5%BD%95%E6%80%81%E7%9A%84%E7%BB%9F%E4%B8%80%E6%8B%A6%E6%88%AA%E5%88%A4%E6%96%AD"}},[_._v("登录态的统一拦截判断")])]),_._v(" "),o("li",[o("a",{attrs:{href:"#%E8%B5%84%E6%BA%90%E6%A8%A1%E5%9D%97%E5%8C%96"}},[_._v("资源模块化")])])]),_._v(" "),o("h3",{attrs:{id:"登录态、userinfo的获取与存储"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#登录态、userinfo的获取与存储"}},[_._v("#")]),_._v(" 登录态、userInfo的获取与存储")]),_._v(" "),o("p",[_._v("主要问题："),o("strong",[_._v("在不影响用户使用的前提下，减少HTTP请求，减少重新授权操作。")])]),_._v(" "),o("ul",[o("li",[_._v("需判断微信服务端中的 "),o("strong",[_._v("session_key是否过期")])]),_._v(" "),o("li",[_._v("登录态、userInfo在前端的存储，"),o("strong",[_._v("减少HTTP请求")])]),_._v(" "),o("li",[_._v("为已授权的用户的userInfo存储到后端，"),o("strong",[_._v("减少重新授权操作")])])]),_._v(" "),o("p",[_._v("解决方案：")]),_._v(" "),o("ul",[o("li",[_._v("采用了"),o("code",[_._v("LS（存储方）")]),_._v(" + "),o("code",[_._v("Vuex（提供方）")]),_._v("搭配方式。\n"),o("ul",[o("li",[_._v("小程序加载，检查"),o("code",[_._v("LS")]),_._v("里的"),o("code",[_._v("登录态")]),_._v("：\n"),o("ul",[o("li",[_._v("若有，将"),o("code",[_._v("登录态")]),_._v("加到请求头；将"),o("code",[_._v("userInfo")]),_._v("存到"),o("code",[_._v("vuex")]),_._v("。（"),o("code",[_._v("LS")]),_._v("在，则证明"),o("code",[_._v("userInfo")]),_._v("也在）")]),_._v(" "),o("li",[_._v("若没有，发起"),o("code",[_._v("wx.login()")]),_._v("，利用"),o("code",[_._v("code")]),_._v("和服务端换取新的"),o("code",[_._v("登录态")]),_._v("。随后将"),o("code",[_._v("登录态")]),_._v("存到"),o("code",[_._v("LS")]),_._v("，并配进请求头；通过与后端拉取"),o("code",[_._v("userInfo")]),_._v("，存到"),o("code",[_._v("LS")]),_._v("、"),o("code",[_._v("Vuex")])])])]),_._v(" "),o("li",[_._v("用户授权时，微信会返回最新"),o("code",[_._v("userInfo")]),_._v("，再更新"),o("code",[_._v("userInfo")]),_._v("到后端")]),_._v(" "),o("li",[o("strong",[_._v("总结：LS存放登录态、userInfo；Vuex存放"),o("code",[_._v("userInfo")]),_._v("；请求头携带"),o("code",[_._v("登录态")])])])])])]),_._v(" "),o("div",{staticClass:"custom-block tip"},[o("p",{staticClass:"custom-block-title"},[_._v("TIP")]),_._v(" "),o("p",[o("strong",[_._v("小程序登录过程：")])]),_._v(" "),o("ul",[o("li",[o("p",[_._v("微信")]),_._v(" "),o("ul",[o("li",[_._v("小程序端调用"),o("code",[_._v("wx.login()")]),_._v("获取"),o("code",[_._v("code")])]),_._v(" "),o("li",[_._v("带着"),o("code",[_._v("code")]),_._v("，传递给开发者后端")]),_._v(" "),o("li",[_._v("开发者后端带着"),o("code",[_._v("code + appid + appsecret")]),_._v("跟微信后端换取"),o("code",[_._v("session_key + openid")])]),_._v(" "),o("li",[_._v("开发者后端将"),o("code",[_._v("自定义登录态")]),_._v("与"),o("code",[_._v("session_key + openid")]),_._v("关联，并响应给小程序"),o("code",[_._v("登录态")]),_._v(" "),o("ul",[o("li",[_._v("并将session_key和openid存到redis里，过期后会重新请求")])])]),_._v(" "),o("li",[_._v("小程序把"),o("code",[_._v("登录态")]),_._v("写入Storage，等到下次有需要登录权限时，从Storage获取")]),_._v(" "),o("li",[_._v("开发者后端通过"),o("code",[_._v("自定义登录态")]),_._v("去查询"),o("code",[_._v("session_key + openid")]),_._v("，返回业务数据")])])]),_._v(" "),o("li",[o("p",[_._v("支付宝")]),_._v(" "),o("ul",[o("li",[_._v("小程序端调用"),o("code",[_._v("getAuthCode")]),_._v("，向支付宝App获取"),o("code",[_._v("auth_code")])]),_._v(" "),o("li",[_._v("小程序端携带"),o("code",[_._v("auth_code")]),_._v("给开发者后端，发起登录验证请求")]),_._v(" "),o("li",[_._v("开发者后端通过"),o("code",[_._v("auth_code")]),_._v("与支付宝授权平台获取"),o("code",[_._v("token")]),_._v("和"),o("code",[_._v("uid")])]),_._v(" "),o("li",[_._v("开发者将"),o("code",[_._v("token")]),_._v("和"),o("code",[_._v("uid")]),_._v("种到session里，并响应给小程序端验证成功")]),_._v(" "),o("li",[_._v("在session有效期内，不需重复授权")])])])])]),_._v(" "),o("h3",{attrs:{id:"登录态的统一拦截判断"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#登录态的统一拦截判断"}},[_._v("#")]),_._v(" 登录态的统一拦截判断")]),_._v(" "),o("p",[_._v("主要问题："),o("strong",[_._v("请求 具有登录权限的接口 时，根据返回的登录态进行统一响应拦截处理")])]),_._v(" "),o("p",[_._v("解决方案：")]),_._v(" "),o("ul",[o("li",[_._v("在"),o("code",[_._v("请求拦截器")]),_._v("中统一加入与后端约定好的"),o("code",[_._v("登录态")]),_._v("自定义属性")]),_._v(" "),o("li",[_._v("在"),o("code",[_._v("响应拦截器")]),_._v("进行判断：\n"),o("ul",[o("li",[_._v("判断后端返回的"),o("code",[_._v("data.code")]),_._v("：\n"),o("ul",[o("li",[_._v("3 - 判断为首次登录，需将响应返回的"),o("code",[_._v("登录态")]),_._v("记录到"),o("code",[_._v("LS")]),_._v("；")]),_._v(" "),o("li",[_._v("2 - "),o("code",[_._v("登录态")]),_._v("失效、发起"),o("code",[_._v("wx.login()")]),_._v("，"),o("strong",[_._v("完成自动登录")]),_._v("后重新再次发起这个请求；（设定session无效、重新尝试的最大次数）")]),_._v(" "),o("li",[_._v("1 - 服务端异常，统一出现报错提示")]),_._v(" "),o("li",[_._v("0 - 请求正常，返回响应结果")])])])])])]),_._v(" "),o("h3",{attrs:{id:"资源模块化"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#资源模块化"}},[_._v("#")]),_._v(" 资源模块化")]),_._v(" "),o("p",[_._v("主要问题："),o("strong",[_._v("体现 “重components，轻pages” 的特点；资源模块化；可维护性")])]),_._v(" "),o("p",[_._v("解决方案："),o("strong",[_._v("按照模块的功能，将资源划分为5块：视图组件、业务组件、数据管理、工具类、数据请求")])]),_._v(" "),o("ul",[o("li",[_._v("视图组件：负责数据呈现、向业务组件传递属性、处理从业务组件发射的事件")]),_._v(" "),o("li",[_._v("业务组件：负责数据处理：请求发起/响应处理、Store里数据的获取/变更、工具类的调用")]),_._v(" "),o("li",[_._v("数据请求：负责接口请求、响应的统一拦截配置、接口文件管理")]),_._v(" "),o("li",[_._v("数据管理：全局Store的管理：按模块去管理vuex实例配置，引入命名空间")]),_._v(" "),o("li",[_._v("工具类：提供处理数据的公用方法。")])]),_._v(" "),o("p",[o("img",{attrs:{src:e(335),alt:"alt"}})])])}),[],!1,null,null,null);v.default=s.exports}}]);
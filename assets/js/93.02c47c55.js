(window.webpackJsonp=window.webpackJsonp||[]).push([[93],{615:function(a,e,s){"use strict";s.r(e);var t=s(56),r=Object(t.a)({},(function(){var a=this,e=a.$createElement,s=a._self._c||e;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h1",{attrs:{id:"lerna"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#lerna"}},[a._v("#")]),a._v(" Lerna")]),a._v(" "),s("p",[a._v("提供了一种集中管理package的目录模式，提供了一套自动化管理程序。让开发者在根项目就可以全局掌控（基于"),s("code",[a._v("npm scripts")]),a._v("）")]),a._v(" "),s("p",[a._v("将多个子包放到一个大工程下，然后通过"),s("code",[a._v("packages")]),a._v("里管理它们。")]),a._v(" "),s("blockquote",[s("p",[a._v("注意: 这些子包的仓库只有一个，也就是这个大工程。")])]),a._v(" "),s("h2",{attrs:{id:"初始化lerna工程"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#初始化lerna工程"}},[a._v("#")]),a._v(" 初始化lerna工程")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("lerna init\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("会创建一个最普通的lerna脚手架：")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("lerna-repo/\n    packages/\n    package.json\n    lerna.json\n    Lerna-debug.json // 存储错误日志\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br")])]),s("h2",{attrs:{id:"创建子包"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#创建子包"}},[a._v("#")]),a._v(" 创建子包")]),a._v(" "),s("p",[a._v("会在"),s("code",[a._v("packages")]),a._v("下新建一个子包，供lerna统一管理。")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("lerna create pkg-name\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("h2",{attrs:{id:"导入子包"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#导入子包"}},[a._v("#")]),a._v(" 导入子包")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("lerna package "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("path"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("lerna会将指定路径的工程全部导入到"),s("code",[a._v("packages")]),a._v("下，并将所有的commit记录一并提交")]),a._v(" "),s("blockquote",[s("p",[a._v("注：这种形式下，子包的所在仓库依然是属于根目录工程下的")])]),a._v(" "),s("h2",{attrs:{id:"本地开发时-引用其他包"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#本地开发时-引用其他包"}},[a._v("#")]),a._v(" 本地开发时，引用其他包")]),a._v(" "),s("h2",{attrs:{id:"lerna-clean-清除所有子包的node-modules文件夹"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#lerna-clean-清除所有子包的node-modules文件夹"}},[a._v("#")]),a._v(" lerna clean 清除所有子包的node_modules文件夹")]),a._v(" "),s("h2",{attrs:{id:"注意"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#注意"}},[a._v("#")]),a._v(" 注意")]),a._v(" "),s("p",[a._v("不要将子包设为"),s("code",[a._v("private: true")]),a._v("，否则它在lerna内的功能将受影响。")]),a._v(" "),s("h2",{attrs:{id:"将子包间的依赖转为软链"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#将子包间的依赖转为软链"}},[a._v("#")]),a._v(" 将子包间的依赖转为软链")]),a._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://loveky.github.io/2018/02/26/tree-shaking-and-pkg.module/",target:"_blank",rel:"noopener noreferrer"}},[a._v("聊聊 package.json 文件中的 module 字段"),s("OutboundLink")],1),a._v(" "),s("img",{attrs:{src:"https://p6.music.126.net/obj/wo3DlcOGw6DClTvDisK1/5774130483/76fe/01f0/a9f5/6f44c706a6225a994bd97de6c52d0b3c.png",alt:"alt"}}),a._v("\n有 "),s("code",[a._v("WARN")]),a._v(" 说明成功")])]),a._v(" "),s("p",[a._v("软链优先级："),s("code",[a._v(".babelrc")]),a._v("里的"),s("code",[a._v("alias")]),a._v("（Web） > "),s("code",[a._v("lerna link")])]),a._v(" "),s("h2",{attrs:{id:"其它"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#其它"}},[a._v("#")]),a._v(" 其它")]),a._v(" "),s("p",[a._v("在RN项目中，遇到软链失效时，可以参考：")]),a._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://medium.com/@dushyant_db/how-to-use-lerna-with-react-native-1eaa79b5d8ec",target:"_blank",rel:"noopener noreferrer"}},[a._v("how-to-use-lerna-with-react-native"),s("OutboundLink")],1)])]),a._v(" "),s("h2",{attrs:{id:"软链后-提示module-not-found-can-t-resolve-xxx"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#软链后-提示module-not-found-can-t-resolve-xxx"}},[a._v("#")]),a._v(" 软链后，提示"),s("code",[a._v("Module not found: Can't resolve xxx")])]),a._v(" "),s("p",[a._v("可能由于webpack 设置了 "),s("code",[a._v("alias")]),a._v(" 导致（但显示的依然是"),s("code",[a._v("alias")]),a._v("的名字）。")]),a._v(" "),s("blockquote",[s("p",[a._v("webpack.alias -> 去子包里找不到"),s("code",[a._v("真身")])])]),a._v(" "),s("div",{staticClass:"language-js line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// demo工程：")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// webpack.config.js")]),a._v("\nresolve"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    alias"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'react-native$'")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'@music/react-native-web-suffix'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'@music/rn-util$'")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'@music/rn-util-web'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'@music/mnb-rn$'")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'@music/mnb-music'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br")])]),s("p",[a._v("一旦 "),s("code",[a._v("webpack")]),a._v(" 里设置 "),s("code",[a._v("alias")]),a._v(" ，工程里遇到"),s("code",[a._v("react-native")]),a._v("。若"),s("code",[a._v("react-native")]),a._v("在子包里也有被引用到，就会先去 "),s("code",[a._v("被引子包")]),a._v("（-rn）里取找这个包（"),s("code",[a._v("@music/react-native-web-suffix")]),a._v("）")]),a._v(" "),s("h3",{attrs:{id:"软链失效-先检查版本"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#软链失效-先检查版本"}},[a._v("#")]),a._v(" 软链失效，先检查版本")]),a._v(" "),s("p",[a._v("若"),s("code",[a._v("-core")]),a._v("被"),s("code",[a._v("-h5")]),a._v("引用，但发现"),s("code",[a._v("-h5")]),a._v("内的"),s("code",[a._v("-core")]),a._v("并不是本地的，检查"),s("code",[a._v("-core")]),a._v("的版本是否和"),s("code",[a._v("-h5")]),a._v("的"),s("code",[a._v("package-lock.json")]),a._v("中对的上")]),a._v(" "),s("h2",{attrs:{id:"提示-script-所用的包不存在"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#提示-script-所用的包不存在"}},[a._v("#")]),a._v(" 提示 script 所用的包不存在")]),a._v(" "),s("p",[a._v("将 "),s("code",[a._v("package-lock.son")]),a._v(" 删除，再 "),s("code",[a._v("npm i")])]),a._v(" "),s("p",[s("img",{attrs:{src:"https://p6.music.126.net/obj/wo3DlcOGw6DClTvDisK1/5777315048/2ba3/e893/0283/fae86b6d83d12e1ec0ef747c3fe97a64.png",alt:"alt"}})]),a._v(" "),s("h2",{attrs:{id:"lerna-publish"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#lerna-publish"}},[a._v("#")]),a._v(" lerna publish")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://p6.music.126.net/obj/wo3DlcOGw6DClTvDisK1/7024067070/fcfb/1988/351d/4c8801db08e27142909fd228784c8728.png",alt:"alt"}})]),a._v(" "),s("p",[a._v("解决：")]),a._v(" "),s("ol",[s("li",[s("code",[a._v("nenpm whoami")]),a._v("检查是否已登录；未登录则"),s("code",[a._v("nenpm login")]),a._v("；")]),a._v(" "),s("li",[a._v("若已登录，可能与"),s("code",[a._v("~/.npmrc")]),a._v("内的 "),s("code",[a._v("authToken")]),a._v(" 无效有关：")]),a._v(" "),s("li",[s("code",[a._v("cat ~/.nenpmrc")]),a._v("，将下面这行复制到 "),s("code",[a._v("~/.npmrc")]),a._v(" 即可")])]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("//rnpm.hz.netease.com/:_authToken"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("xxx\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("ol",{attrs:{start:"4"}},[s("li",[a._v("若还是不行，"),s("a",{attrs:{href:"http://npmadmin.hz.netease.com/#/npmAccount",target:"_blank",rel:"noopener noreferrer"}},[a._v("重置"),s("code",[a._v("nenpm")]),a._v("密码"),s("OutboundLink")],1),a._v("后重试 第3步。")])]),a._v(" "),s("h2",{attrs:{id:"watchman-error"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#watchman-error"}},[a._v("#")]),a._v(" watchman error")]),a._v(" "),s("blockquote",[s("p",[a._v("Watchman error: too many pending cache jobs. Make sure watchman is running for this project.")])]),a._v(" "),s("h2",{attrs:{id:"module和main字段的优先级"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#module和main字段的优先级"}},[a._v("#")]),a._v(" module和main字段的优先级")]),a._v(" "),s("h2",{attrs:{id:"peerdependencies"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#peerdependencies"}},[a._v("#")]),a._v(" peerDependencies")]),a._v(" "),s("h2",{attrs:{id:"jest-haste-map-haste-module-naming-collision-react-native"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#jest-haste-map-haste-module-naming-collision-react-native"}},[a._v("#")]),a._v(" jest-haste-map: Haste module naming collision: react-native")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://p5.music.126.net/obj/wo3DlcOGw6DClTvDisK1/7042648181/e168/cba8/a737/81a85b4526efd16bd25977519738272f.png",alt:"alt"}})]),a._v(" "),s("p",[a._v("添加"),s("code",[a._v("metro.config.js")]),a._v("的"),s("code",[a._v("blacklist")]),a._v(":\nhttps://stackoverflow.com/questions/41813211/how-to-make-react-native-packager-ignore-certain-directories")]),a._v(" "),s("h2",{attrs:{id:"所有lerna-bootstrap-会导致"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#所有lerna-bootstrap-会导致"}},[a._v("#")]),a._v(" 所有lerna bootstrap 会导致")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://p5.music.126.net/obj/wo3DlcOGw6DClTvDisK1/7048190758/d1d9/60da/d780/0de99e07578c74c1bd045bc74bd81639.png",alt:"alt"}})]),a._v(" "),s("h2",{attrs:{id:"重装watchman-发生homebrew报错"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#重装watchman-发生homebrew报错"}},[a._v("#")]),a._v(" 重装watchman，发生homebrew报错")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("cd")]),a._v(" /usr/local/Homebrew/Library/Taps/homebrew\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("rm")]),a._v(" -rf homebrew-core\nbrew upgrade\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br")])]),s("p",[a._v("使用brew upgrade后会重新更新homebrew-core")]),a._v(" "),s("h2",{attrs:{id:"使用sdp发布时-lerna接收参数前需进行转换"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用sdp发布时-lerna接收参数前需进行转换"}},[a._v("#")]),a._v(" 使用sdp发布时，lerna接收参数前需进行转换")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"build:demo:web"')]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"lerna run --scope @music/rpc-audio-rn build:web -- -- "')]),a._v(",\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("https://github.com/lerna/lerna/issues/1106")])])}),[],!1,null,null,null);e.default=r.exports}}]);